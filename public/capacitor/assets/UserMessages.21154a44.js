import{Q as B}from"./QCard.ec410a0e.js";import{Q as N,f as L,g as R,h as V}from"./QCheckbox.b8d0cf70.js";import{Q as F}from"./QCardSection.3d25e11d.js";import{Q as M}from"./QForm.b5701193.js";import{Q as T}from"./QImg.786665cf.js";import{V as Y,r as u,c as U,w as E,X as G,R as f,S as q,f as o,Y as s,bd as P,a0 as h,a1 as w,a3 as C,Q as z,U as p,F as W,$ as X,a4 as j,a7 as H}from"./index.08e86ffb.js";import{b as J,Q as K,c as O}from"./QTable.7b2293dc.js";import{Q as Z}from"./ClosePopup.71a35b4b.js";import{u as $,b as ee,t as te,a as A,m as ae}from"./axios.dd0a7574.js";import oe from"./Chat.85d4731b.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as re}from"./i18n.a0f971c3.js";import"./use-dark.09fea322.js";import"./QSeparator.e65deedb.js";import"./QSpace.2b47e780.js";import"./QLayout.f367b0a4.js";import"./QFooter.d4249803.js";import"./TouchPan.81640d8c.js";import"./use-quasar.41efb91a.js";const se={components:{Chat:oe},setup(){var I,S;const i=(S=(I=re)==null?void 0:I.global)==null?void 0:S.t,n=Y(),_=$(),{crudAction:e,notifyAction:g}=_,x=u(!1),Q=u(!1),l=u({}),a=u("my_chats"),d=u(0),c=U(()=>_.authGetter),b="api/messages";v({user_id:c.value.id}),E(a,()=>v({user_id:c.value.id}));function v(t){e({...t,url:`${b}/rooms`,method:"get",mutate:a.value}).catch(r=>g({error:"chatsAction",e:r}))}function D(t){confirm("Are You Sure You Want To "+(t.forever?"Delete Forever":"Delete")+" chat"+t.id)===!0&&A({url:`${b}/${t.id}`,method:"delete"}).then(()=>v({user_id:t.user_id,refresh:["reloadApp"]})).catch(r=>g({error:"deleteChatAction",e:r}))}return{auth:c,height:u(screen.height/1.4),filter:u(""),chatData:l,viewChat:x,ContactUs:Q,baseURL:ee,chats:a,roomId:d,timeago:te,ipDebug:U(()=>{var t;return(t=_.configGetter)==null?void 0:t.ipDebug}),admin:["Admin","Seller","Buyer"],seller:["Seller","Buyer"],getUserName(t){let r;return t==null||t.forEach(m=>{var y;if(((y=m==null?void 0:m.user)==null?void 0:y.email)!==c.value.email)return r=m.user}),r==null?void 0:r.name},usersMessages(){var t;A({url:"api/users",method:"post",data:{user_id:((t=c.value)==null?void 0:t.id)||null,user_room:!0}}).then(({data:r})=>n.push({path:`/chat/${r}`})).catch(r=>g({error:"chatRoom",e:r}))},chatRoom(t){d.value=t.room_id,x.value=!0,v({user_id:t.user_id})},Delete:D,delete_forever(t){D({...t,forever:!0,id:0,user_id:0})},restore(t){A.post("api/categories",t).then(()=>ae(["reloadApp"])).then(()=>v({user_id:t.user_id})).catch(r=>g({error:"restoreChatAction",e:r}))},pagination:{sortBy:"asc",descending:!1,page:1,rowsPerPage:0,rowsNumber:10},columns:[{name:"pic",align:"center",label:i("picture"),field:"pic",sortable:!0},{name:"chat_title",align:"center",label:i("chat_title"),field:"name",sortable:!0},{name:"address",align:"center",label:i("address"),field:"address",sortable:!0},{name:"city",align:"center",label:i("city"),field:"city",sortable:!0},{name:"end_date",align:"center",label:i("expiry"),field:"end_date",sortable:!0},{name:"edit",align:"center",label:i("edit"),field:"edit",sortable:!1},{name:"delete",align:"center",label:i("delete"),field:"delete",sortable:!1}],rows:U(()=>{var t;return(t=_[a.value]||[])==null?void 0:t.filter(r=>{var y;const m=(y=r==null?void 0:r.room)==null?void 0:y.messages;return m==null?void 0:m.filter(k=>k==null?void 0:k.message).length})})}}},ie={class:"text-h6"},ne={class:"q-pa-md q-gutter-md"},de={class:"text-weight-medium"},ce={class:"text-grey-8"},me={class:"text-grey-8 q-gutter-xs"},ue={class:"timestamp"};function fe(i,n,_,e,g,x){const Q=G("Chat");return f(),q("div",null,[o(N,{modelValue:e.viewChat,"onUpdate:modelValue":n[0]||(n[0]=l=>e.viewChat=l)},{default:s(()=>[o(B,{class:"my-card",style:{width:"100%","max-width":"1000px"}},{default:s(()=>[o(Q,{roomId:e.roomId},null,8,["roomId"])]),_:1})]),_:1},8,["modelValue"]),o(N,{modelValue:e.ContactUs,"onUpdate:modelValue":n[1]||(n[1]=l=>e.ContactUs=l)},{default:s(()=>[o(B,{class:"my-card text-white",style:{width:"100%","max-width":"1000px"}},{default:s(()=>[o(F,{class:"bg-primary"},{default:s(()=>[h("div",ie,w(i.$t("Contact Us")),1)]),_:1}),o(M,{class:"q-pa-sm"})]),_:1})]),_:1},8,["modelValue"]),o(J,{"hide-header":"",style:P("height:"+e.height+"px"),ref:"table",title:i.$t("Chats List"),rows:e.rows,columns:e.columns,"row-key":"name","virtual-scroll":"","virtual-scroll-item-size":48,"rows-per-page-options":[0],filter:e.filter,"binary-state-sort":""},{body:s(l=>[h("div",ne,[o(K,{bordered:"",class:"rounded-borders ellipsis",style:{"max-width":"1600px"}},{default:s(()=>[o(L,null,{default:s(()=>[o(R,{style:{"max-width":"150px","max-height":"150px"}},{default:s(()=>{var a,d;return[(d=(a=l.row)==null?void 0:a.post)!=null&&d.pics[0]?(f(),C(T,{key:0,src:e.baseURL+"/"+l.row.post.pics[0].pic},null,8,["src"])):(f(),C(z,{key:1,name:"fas fa-plus-circle",color:"black",size:"150px"}))]}),_:2},1024),o(R,null,{default:s(()=>[o(V,{lines:"1",class:"q-mt-xs text-body2 text-weight-bold text-primary text-uppercase"},{default:s(()=>[o(p,{flat:"",dense:"",label:l.row.post.post_title,to:"/chat/"+l.row.room_id},null,8,["label","to"])]),_:2},1024),o(V,{lines:"1"},{default:s(()=>{var a,d;return[h("span",de,w(e.getUserName((d=(a=l.row)==null?void 0:a.room)==null?void 0:d.messages)),1)]}),_:2},1024),o(V,{lines:"1"},{default:s(()=>{var a,d,c,b;return[h("span",ce,w((b=(c=(d=(a=l.row)==null?void 0:a.room)==null?void 0:d.messages)==null?void 0:c.at(-1))==null?void 0:b.message),1)]}),_:2},1024),h("div",me,[e.chats==="trash"?(f(),q(W,{key:0},[o(p,{size:"12px",flat:"",dense:"",label:i.$t("restore"),icon:"restore",onClick:a=>e.restore(l.row)},null,8,["label","onClick"]),o(p,{size:"12px",flat:"",dense:"",label:i.$t("delete_forever"),icon:"delete_forever",onClick:X(a=>e.delete_forever(l.row),["prevent"])},null,8,["label","onClick"])],64)):(f(),C(p,{key:1,size:"12px",flat:"",dense:"",label:i.$t("delete"),icon:"delete",onClick:a=>e.Delete(l.row)},null,8,["label","onClick"])),o(p,{dense:"",flat:"",icon:"fas fa-comments",title:"Views",onClick:a=>e.chatRoom(l.row)},null,8,["onClick"])]),h("small",ue,w(e.timeago(l.row.updated_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"top-right":s(()=>{var l;return[o(O,{modelValue:e.chats,"onUpdate:modelValue":n[2]||(n[2]=a=>e.chats=a),class:"my-custom-toggle q-ma-md","no-caps":"",push:"",rounded:"",glossy:"",unelevated:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"fas fa-message",value:"my_chats"}].concat(e.ipDebug||((l=e.auth)==null?void 0:l.role)==="Admin"?[{icon:"fas fa-envelope",value:"contact_us"},{icon:"fas fa-users",value:"users_chats"}]:[])},null,8,["modelValue","options"]),e.ipDebug?(f(),C(p,{key:0,icon:"add",onClick:n[3]||(n[3]=a=>e.ContactUs=!e.ContactUs)})):j("",!0),o(Z,{clearable:"",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":n[4]||(n[4]=a=>e.filter=a),placeholder:i.$t("search")},{append:s(()=>[o(z,{name:"search"})]),_:1},8,["modelValue","placeholder"])]}),default:s(()=>[H(w(e.rows)+" ",1)]),_:1},8,["style","title","rows","columns","filter"])])}var Ne=le(se,[["render",fe],["__scopeId","data-v-22376c7e"]]);export{Ne as default};
