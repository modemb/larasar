import{r as u,c as w,o as H,w as K,u as O,X as F,R as m,S,f as a,Y as i,bd as Z,J as $,U as c,a0 as _,a3 as h,Q as G,a1 as P,a7 as I,a4 as k,F as M,$ as D,ad as ee,ae as te}from"./index.08e86ffb.js";import{Q as oe}from"./QCardSection.3d25e11d.js";import{Q as W}from"./QCard.ec410a0e.js";import{Q as J,f as ae,g as U,h as z}from"./QCheckbox.b8d0cf70.js";import{Q as le}from"./QImg.786665cf.js";import{Q as re}from"./PostLocation.18462df1.js";import{b as se,Q as ie,c as X}from"./QTable.7b2293dc.js";import{Q as ne,C as de}from"./ClosePopup.71a35b4b.js";import{u as ce,t as ue,b as me,a as A,o as fe}from"./axios.dd0a7574.js";import{d as ge}from"./Functions.a6828b9d.js";import pe from"./UserReports.1bc0db70.js";import{P as _e}from"./UserPost.9b6312ed.js";import{_ as ve}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as he}from"./i18n.a0f971c3.js";import"./use-dark.09fea322.js";import"./QLayout.f367b0a4.js";import"./QSeparator.e65deedb.js";import"./TouchPan.81640d8c.js";import"./export-file.200e4ebe.js";import"./QForm.b5701193.js";import"./GoogleAutocomplete.1506f244.js";import"./QToggle.c5ba4237.js";import"./QPopupProxy.40be37ab.js";import"./QTooltip.6758108f.js";import"./QTr.5fbb2c40.js";import"./use-quasar.41efb91a.js";import"./QSpace.2b47e780.js";import"./UserFiles.b62f67b7.js";import"./QPage.04ecbe7a.js";import"./QPageContainer.58a868ff.js";import"./QEditor.2dc398a7.js";import"./QBtnDropdown.92e4f5d8.js";import"./UserCheckout.70f50a93.js";import"./UserShare.9975d54e.js";import"./Auth.1fdd8b5e.js";const be={components:{Reports:pe,Post:_e},setup(){const l=he.global.t,r=ce(),{crudAction:B,notifyAction:e}=r,Q=u(!1),V=u({}),g=u("my_posts"),x=u([]),o=u(!1),s=u(!1),d=u(null),v=w(()=>{var t;return(t=r[g.value])==null?void 0:t.last_page}),f=w(()=>{var t;return(t=r[g.value])==null?void 0:t.total}),C=w(()=>{var t;return(t=r.reloadGetter)==null?void 0:t.reload}),q=w(()=>{var t;return((t=r[g.value])==null?void 0:t.data)||[]}),b=w(()=>r.authGetter);H(()=>{var t;return p({user_id:(t=b.value)==null?void 0:t.id})}),K([g,C],()=>{var t;y.value.page=1,p({user_id:(t=b.value)==null?void 0:t.id})});const y=u({sortBy:"asc",descending:!1,page:1,rowsPerPage:0,rowsNumber:f.value});function p(t){B({...t,url:"api/categories/postsAction",page:y.value.page,method:"get",mutate:g.value,timeout:1e3}).catch(n=>e({error:"postsAction",e:n}))}function R(t){confirm("Are You Sure You Want To "+(t.forever?"Delete Forever":"Delete")+" Post"+t.id)===!0&&A({url:`api/categories/${t.id}`,method:"delete",data:{post:1,auth_id:b.value.id}}).then(({data:{success:n}})=>{y.value.page=1,p({user_id:t.user_id,success:n,refresh:["reloadApp"]})}).catch(n=>e({error:"deletePostAction",e:n}))}return{auth:b,loading:s,total:f,table:d,height:u(screen.height/1.4),filter:u(""),timeago:ue,postData:V,editPost:Q,baseURL:me,getPosts:g,print:o,post_reports:x,admin:["Admin","Seller","Buyer"],seller:["Seller","Buyer"],dateDiffInDays:ge,renewPost(t){A({url:"api/categories/renewPost",method:"put",data:{post_id:t,renewPost:1}}).then(()=>p({user_id:b.value.id,refresh:["reloadApp"]})).catch(n=>e({error:"renewPost",e:n}))},archive(t){confirm("Are You Sure You Want To Archive Post")===!0&&A({url:"api/categories/archive",data:{archive:1,post_id:t.id,user_id:t.user_id},method:"put"}).then(()=>p({user_id:t.user_id,refresh:["reloadApp"],success:"Post Archived Successfully"})).catch(n=>e({error:"archivePostAction",e:n}))},receipt(t){o.value=!0,x.value=t.reports},edit(t){V.value=t,Q.value=!0,p({user_id:t.user_id})},logUserAction:fe,Delete:R,delete_forever(t){R({...t,forever:!0})},restore(t){A.post("api/categories",t).then(()=>{p({user_id:t.user_id,refresh:["reloadApp"]})}).catch(n=>e({error:"restorePostAction",e:n}))},onScroll({to:t,ref:n}){var Y;const T=((Y=q.value)==null?void 0:Y.length)-1,L=y.value.page,N=v.value;s.value!==!0&&L<N&&t===T&&(s.value=!0,setTimeout(()=>{var E;y.value.page++,p({user_id:(E=b.value)==null?void 0:E.id,load:!0}),O(()=>{n.refresh(),s.value=!1})},500)),console.log("page",L,"<","lastPage",N,"to",t,"===",T,"lastIndex",">",0,"total",f.value)},columns:[{name:"post_title",align:"center",label:l("post_title"),field:"post_title",sortable:!0},{name:"description",align:"center",label:"description",field:"description",sortable:!0},{name:"address",align:"center",label:l("address"),field:"address",sortable:!0},{name:"city",align:"center",label:l("city"),field:"city",sortable:!0},{name:"end_date",align:"center",label:l("expiry"),field:"end_date",sortable:!0}],rows:q,pagination:w(()=>y.value)}}},j=l=>(ee("data-v-7cffdc7b"),l=l(),te(),l),ye={class:"q-pa-md q-gutter-md"},we={class:"text-weight-medium"},Pe={class:"text-grey-8"},ke=j(()=>_("i",{class:"q-pa-md fas fa-receipt"},null,-1)),xe=j(()=>_("i",{class:"q-pa-md fas fa-long-arrow-alt-right"},null,-1)),Ce={class:"text-grey-8 q-gutter-xs"},De={class:"timestamp"},Ae={class:"text-grey-8 q-gutter-xs"};function Qe(l,r,B,e,Q,V){const g=F("Reports"),x=F("Post");return m(),S("div",null,[a(J,{modelValue:e.print,"onUpdate:modelValue":r[0]||(r[0]=o=>e.print=o)},{default:i(()=>[a(W,{class:"my-card text-black"},{default:i(()=>[a(oe,{class:"bg-primary text-white"},{default:i(()=>[$(a(c,{dense:"",round:"",class:"float-right",icon:"close"},null,512),[[de]])]),_:1}),a(g,{post_reports:e.post_reports},null,8,["post_reports"])]),_:1})]),_:1},8,["modelValue"]),a(J,{modelValue:e.editPost,"onUpdate:modelValue":r[1]||(r[1]=o=>e.editPost=o)},{default:i(()=>[a(W,{class:"my-card col-12",style:{width:"1250px"}},{default:i(()=>[a(x,{postData:e.postData,getPosts:e.getPosts,onReload:e.edit},null,8,["postData","getPosts","onReload"])]),_:1})]),_:1},8,["modelValue"]),a(se,{style:Z(`height: ${e.height}px`),title:`${l.$t("posts_list")} ${e.total}`,rows:e.rows,columns:e.columns,filter:e.filter,loading:e.loading,"row-key":"name",ref:"table","hide-header":"","binary-state-sort":"","virtual-scroll":"","virtual-scroll-item-size":150,"virtual-scroll-sticky-size-start":150,pagination:e.pagination,"onUpdate:pagination":r[5]||(r[5]=o=>e.pagination=o),onVirtualScroll:e.onScroll},{body:i(o=>[_("div",ye,[a(ie,{bordered:"",class:"rounded-borders ellipsis",style:{"max-width":"1600px"}},{default:i(()=>[a(ae,null,{default:i(()=>[a(U,{style:{"max-width":"150px","max-height":"150px",cursor:"pointer"},onClick:s=>e.edit(o.row)},{default:i(()=>{var s,d,v,f,C;return[(d=(s=o==null?void 0:o.row)==null?void 0:s.pics)!=null&&d[0]?(m(),h(le,{key:0,src:e.baseURL+"/"+((C=(f=(v=o==null?void 0:o.row)==null?void 0:v.pics)==null?void 0:f[0])==null?void 0:C.pic)},null,8,["src"])):(m(),h(G,{key:1,name:"fas fa-plus-circle",color:"black",size:"150px"}))]}),_:2},1032,["onClick"]),a(U,null,{default:i(()=>{var s;return[a(z,{lines:"1"},{default:i(()=>[_("span",we,P(o.row.city),1),_("span",Pe,P(o.row.postal_code),1)]),_:2},1024),a(z,{lines:"1",class:"q-mt-xs text-body2 text-weight-bold text-primary text-uppercase"},{default:i(()=>[a(c,{flat:"",dense:"",label:o.row.post_title,to:"/post/"+o.row.id},null,8,["label","to"])]),_:2},1024),a(z,{caption:"",lines:"1"},{default:i(()=>[a(c,{size:"12px",flat:"",dense:"",icon:o.row.extend_date?"email":"",onClick:d=>e.receipt(o.row)},{default:i(()=>[ke,I(" "+P(o.row.start_date)+" ",1),xe,I(" "+P(o.row.end_date),1)]),_:2},1032,["icon","onClick"])]),_:2},1024),_("div",Ce,[a(c,{dense:"",flat:"",icon:"fas fa-eye",title:"Views",onClick:d=>e.edit(o.row)},{default:i(()=>[a(re,{color:"orange","text-color":"black",label:o.row.count,floating:""},null,8,["label"])]),_:2},1032,["onClick"]),!o.row.end_date&&e.getPosts!=="trashed_posts"?(m(),h(c,{key:0,flat:"",dense:"",size:"12px",icon:"upload",label:l.$t("Publish Post"),onClick:d=>e.renewPost(o.row.id)},null,8,["label","onClick"])):k("",!0),((s=e.auth)==null?void 0:s.role)==="Admin"?(m(),S(M,{key:1},[e.getPosts!=="expired_posts"&&e.getPosts!=="trashed_posts"?(m(),h(c,{key:0,flat:"",dense:"",size:"12px",icon:"archive",label:l.$t("archive_post"),onClick:d=>e.archive(o.row)},null,8,["label","onClick"])):k("",!0),a(c,{flat:"",dense:"",size:"12px",label:l.$t("Log User"),icon:"fas fa-sign-in-alt",onClick:D(d=>{var v,f;return e.logUserAction((f=(v=o.row)==null?void 0:v.user)==null?void 0:f.id)},["prevent"])},null,8,["label","onClick"])],64)):k("",!0),e.getPosts==="trashed_posts"?(m(),S(M,{key:2},[a(c,{size:"12px",flat:"",dense:"",label:l.$t("restore"),icon:"restore",onClick:d=>e.restore(o.row)},null,8,["label","onClick"]),a(c,{size:"12px",flat:"",dense:"",label:l.$t("delete_forever"),icon:"delete_forever",onClick:D(d=>e.delete_forever(o.row),["prevent"])},null,8,["label","onClick"])],64)):(m(),h(c,{key:3,size:"12px",flat:"",dense:"",label:l.$t("delete"),icon:"delete",onClick:D(d=>e.Delete(o.row),["prevent"])},null,8,["label","onClick"]))]),_("small",De,P(e.timeago(o.row.start_date)),1)]}),_:2},1024),e.getPosts!=="trashed_posts"?(m(),h(U,{key:0,side:""},{default:i(()=>[_("div",Ae,[I(P(l.$t("expiry"))+" ",1),a(c,{rounded:"",flat:e.dateDiffInDays(Date(),o.row.end_date)>6,icon:e.dateDiffInDays(Date(),o.row.end_date)>6?"":"fas fa-redo",label:e.dateDiffInDays(Date(),o.row.end_date)+" days",onClick:D(s=>e.dateDiffInDays(Date(),o.row.end_date)>6||e.renewPost(o.row.id),["prevent"])},null,8,["flat","icon","label","onClick"])])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024)])]),"top-right":i(()=>{var o;return[a(X,{modelValue:e.getPosts,"onUpdate:modelValue":r[2]||(r[2]=s=>e.getPosts=s),push:"",glossy:"","toggle-color":"primary",options:[{label:l.$t("my_posts"),value:"my_posts"},{label:l.$t("gallery"),value:"gallery"},{label:l.$t("Expired Posts"),value:"expired_posts"},{icon:"restore",value:"trashed_posts"}]},null,8,["modelValue","options"]),((o=e.auth)==null?void 0:o.role)==="Admin"?(m(),h(X,{key:0,modelValue:e.getPosts,"onUpdate:modelValue":r[3]||(r[3]=s=>e.getPosts=s),class:"my-custom-toggle q-ma-md","no-caps":"",push:"",rounded:"",glossy:"",unelevated:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"flag",value:"flag"},{icon:"fas fa-users",value:"users_posts"},{label:l.$t("all"),value:"all_posts"},{label:l.$t("All Expired"),value:"expired_user_posts"},{icon:"restore",value:"all_trashed_posts"}]},null,8,["modelValue","options"])):k("",!0),a(ne,{clearable:"",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":r[4]||(r[4]=s=>e.filter=s),placeholder:l.$t("search")},{append:i(()=>[a(G,{name:"search"})]),_:1},8,["modelValue","placeholder"])]}),_:1},8,["style","title","rows","columns","filter","loading","pagination","onVirtualScroll"])])}var ct=ve(be,[["render",Qe],["__scopeId","data-v-7cffdc7b"]]);export{ct as default};
