import{r as c,c as w,o as G,w as I,u as J,R as Y,S as K,f as o,Y as i,bd as L,U as h,a0 as v,J as q,Q as O,a7 as S,a1 as m,a3 as E,a4 as F}from"./index.08e86ffb.js";import{Q as W}from"./QToggle.c5ba4237.js";import{d as H,e as X,Q as Z}from"./export-file.200e4ebe.js";import{Q as $}from"./QPopupProxy.40be37ab.js";import{b as ee,c as ae}from"./QTable.7b2293dc.js";import{Q as te,C as R}from"./ClosePopup.71a35b4b.js";import{Q as le,a as u}from"./QTr.5fbb2c40.js";import{Q as oe}from"./QImg.786665cf.js";import{u as re}from"./use-quasar.41efb91a.js";import{u as ie,b as ne}from"./axios.dd0a7574.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as ue}from"./i18n.a0f971c3.js";import"./QCheckbox.b8d0cf70.js";import"./use-dark.09fea322.js";import"./QSeparator.e65deedb.js";function j(n,s,k){let e=s!==void 0?s(n,k):n;return e=e==null?"":String(e),e=e.split('"').join('""'),`"${e}"`}const de={setup(){var U,B;const n=ie(),{crudAction:s,notifyAction:k}=n,e=(B=(U=ue)==null?void 0:U.global)==null?void 0:B.t,C=re(),T=Date.now(),a=H.formatDate(T,"YYYY/MM/DD"),l=c(a),r=c("today"),f=c(""),y=c([{name:"id",align:"center",label:"ID",field:"id",sortable:!0},{name:"ip",align:"center",label:e("ip"),field:"ip",sortable:!0},{name:"city",align:"center",label:e("city"),field:"city",sortable:!0},{name:"region",align:"center",label:e("region"),field:"region",sortable:!0},{name:"country",align:"center",label:e("country"),field:"country",sortable:!0},{name:"slug",align:"center",label:e("slug"),field:"slug",sortable:!0},{name:"pic",align:"center",label:e("pic"),field:"pic",sortable:!0},{name:"post_title",align:"left",label:e("post_title"),field:"post_title",sortable:!0},{name:"first_name",align:"center",label:e("first_name"),field:"first_name",sortable:!0},{name:"last_name",align:"center",label:e("last_name"),field:"last_name",sortable:!0},{name:"email",align:"center",label:e("email"),field:"email",sortable:!0}]),V=c(!1),b=w(()=>"viewsGetter"+r.value),A=w(()=>{var t;return(t=n[b.value])==null?void 0:t.last_page}),z=w(()=>{var t;return(t=n.reloadGetter)==null?void 0:t.reload}),x=w(()=>{var t;return(t=n[b.value])==null?void 0:t.total}),D=w(()=>{var t;return((t=n[b.value])==null?void 0:t.data)||[]}),p=c({sortBy:"desc",page:1,rowsPerPage:0,rowsNumber:x.value});c(2),G(()=>_({})),I([r,z],()=>{p.value.page=1,_({})});const P=[];I(f,t=>{p.value.page=1,P.includes(t)||_({filterViews:t,load:!0}),P.push(t)});function _(t){return console.log("getter",b.value),s({...t,url:"api/users/views",method:"get",period:r.value,page:p.value.page,perPage:p.value.rowsPerPage,mutate:b.value,timeout:1e3}).catch(Q=>k({error:"viewsAction",e:Q}))}return{filter:f,loading:V,baseURL:ne,rows:D,columns:y,total:x,height:c(screen.height/1.4),period:r,range:c(!1),proxyDate:l,save(){r.value="",_({expandingRow:!0,refresh:[b.value],from:l.value.from,to:l.value.to,proxyDate:l.value})},fNum(t){return isNaN(t)||t<9999?t:t<1e6?Math.round(t/1e3)+"K":t<1e7?(t/1e6).toFixed(2)+"M":t<1e9?Math.round(t/1e6)+"M":t<1e12?Math.round(t/1e9)+"B":"1T+"},exportTable(){const t=[y.value.map(g=>j(g.label))].concat(D.value.map(g=>y.value.map(d=>j(typeof d.field=="function"?d.field(g):g[d.field===void 0?d.name:d.field],d.format,g)).join(","))).join(`\r
`);X("table-export.csv",t,"text/csv")!==!0&&C.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},pagination:p,onScroll({to:t,ref:Q}){var N;const g=((N=D.value)==null?void 0:N.length)-1,d=A.value,M=p.value.page;V.value!==!0&&M<d&&t===g&&(V.value=!0,setTimeout(()=>{p.value.page++,_({load:!0}),J(()=>{Q.refresh(),V.value=!1})},500)),console.log("page",M,"<","lastPage",d,"to",t,"===",g,"lastIndex",">",0,"total",x.value)}}}},ce={class:"q-pa-md"},me={class:"row items-center justify-end q-gutter-sm"},fe={class:"text-pre-wrap"},ge={class:"text-pre-wrap"},pe={class:"text-pre-wrap"},ve={class:"text-pre-wrap"},ye={class:"text-pre-wrap"},be={class:"text-pre-wrap"};function _e(n,s,k,e,C,T){return Y(),K("div",ce,[o(ee,{flat:"",bordered:"",style:L(`height: ${e.height}px`),class:"my-sticky-virtscroll-table *my-sticky-dynamic",title:`${n.$t("views")} ${e.total}`,rows:e.rows,columns:e.columns,loading:e.loading,filter:e.filter,"row-key":"name","binary-state-sort":"","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:e.pagination,"onUpdate:pagination":s[4]||(s[4]=a=>e.pagination=a),onVirtualScroll:e.onScroll},{"top-right":i(()=>[o(h,{color:"primary","icon-right":"archive",label:n.$t("export_to_csv"),"no-caps":"",onClick:e.exportTable},null,8,["label","onClick"]),o(h,{color:"primary",class:"q-ma-xs",icon:"event",label:JSON.stringify(e.proxyDate)},{default:i(()=>[o($,{"transition-show":"scale","transition-hide":"scale"},{default:i(()=>[o(Z,{modelValue:e.proxyDate,"onUpdate:modelValue":s[1]||(s[1]=a=>e.proxyDate=a),range:e.range},{default:i(()=>[v("div",me,[q(o(h,{label:"Cancel",color:"primary",flat:""},null,512),[[R]]),o(W,{modelValue:e.range,"onUpdate:modelValue":s[0]||(s[0]=a=>e.range=a),label:"Range"},null,8,["modelValue"]),q(o(h,{label:"OK",color:"primary",flat:"",onClick:e.save},null,8,["onClick"]),[[R]])])]),_:1},8,["modelValue","range"])]),_:1})]),_:1},8,["label"]),o(ae,{modelValue:e.period,"onUpdate:modelValue":s[2]||(s[2]=a=>e.period=a),push:"",glossy:"","toggle-color":"primary",options:[{icon:"fas fa-sync",value:"today"},{label:n.$t("Day"),value:"-1 day"},{label:n.$t("Week"),value:"-1 week"},{label:n.$t("Month"),value:"-1 month"},{label:n.$t("Year"),value:"-1 year"}]},null,8,["modelValue","options"]),o(te,{clearable:"",class:"q-ma-xs col-md-3",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":s[3]||(s[3]=a=>e.filter=a),placeholder:n.$t("search")},{append:i(()=>[o(O,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),body:i(a=>[o(le,{props:a},{default:i(()=>[o(u,{key:"id",props:a},{default:i(()=>[S(m(a.row.id),1)]),_:2},1032,["props"]),o(u,{key:"ip",props:a},{default:i(()=>[v("div",fe,m(a.row.ip),1)]),_:2},1032,["props"]),o(u,{key:"city",props:a},{default:i(()=>{var l;return[v("div",ge,m((l=a.row)==null?void 0:l.city),1)]}),_:2},1032,["props"]),o(u,{key:"region",props:a},{default:i(()=>{var l;return[v("div",pe,m((l=a.row)==null?void 0:l.region),1)]}),_:2},1032,["props"]),o(u,{key:"country",props:a},{default:i(()=>{var l;return[v("div",ve,m((l=a.row)==null?void 0:l.country),1)]}),_:2},1032,["props"]),o(u,{key:"slug",props:a},{default:i(()=>{var l,r,f;return[(l=a.row)!=null&&l.slug?(Y(),E(h,{key:0,color:"primary",to:(r=a.row)==null?void 0:r.slug,label:(f=a.row)==null?void 0:f.slug},null,8,["to","label"])):F("",!0)]}),_:2},1032,["props"]),o(u,{key:"pic",props:a},{default:i(()=>{var l,r,f,y;return[o(oe,{src:e.baseURL+"/"+((y=(f=(r=(l=a.row)==null?void 0:l.post)==null?void 0:r.pics)==null?void 0:f[0])==null?void 0:y.pic)},null,8,["src"])]}),_:2},1032,["props"]),o(u,{key:"post_title",props:a},{default:i(()=>{var l,r;return[v("div",ye,m((r=(l=a.row)==null?void 0:l.post)==null?void 0:r.post_title),1)]}),_:2},1032,["props"]),o(u,{key:"first_name",props:a},{default:i(()=>{var l,r;return[S(m((r=(l=a.row)==null?void 0:l.user)==null?void 0:r.first_name),1)]}),_:2},1032,["props"]),o(u,{key:"last_name",props:a},{default:i(()=>{var l,r;return[S(m((r=(l=a.row)==null?void 0:l.user)==null?void 0:r.last_name),1)]}),_:2},1032,["props"]),o(u,{key:"email",props:a},{default:i(()=>{var l,r;return[v("div",be,m((r=(l=a.row)==null?void 0:l.user)==null?void 0:r.email),1)]}),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["style","title","rows","columns","loading","filter","pagination","onVirtualScroll"])])}var Ie=se(de,[["render",_e]]);export{Ie as default};
