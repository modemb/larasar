import{Q as P,C as ke}from"./ClosePopup.71a35b4b.js";import{a9 as Ne,r as m,c as _,o as Ve,w as j,u as Se,X as ee,R as d,S as C,f as l,Y as n,bc as Ae,bd as Pe,F,U as N,$ as T,J as xe,a2 as H,a4 as S,a0 as Y,a3 as x,a7 as ae,a1 as L,Q as pe}from"./index.08e86ffb.js";import{Q as fe}from"./QSeparator.e65deedb.js";import{Q as oe}from"./QCard.ec410a0e.js";import{Q as ye,f as be,g as M,h as B}from"./QCheckbox.b8d0cf70.js";import{Q as qe}from"./QToggle.c5ba4237.js";import{Q as Qe}from"./QTooltip.6758108f.js";import{Q as Ue}from"./QCardSection.3d25e11d.js";import{b as De,Q as ve}from"./QTable.7b2293dc.js";import{Q as Ie}from"./QImg.786665cf.js";import{W as Te,P as Le,Q as Ge}from"./UserPost.9b6312ed.js";import{u as Ye}from"./use-quasar.41efb91a.js";import{u as Be,c as q,b as Re,t as ze,a as R}from"./axios.dd0a7574.js";import{L as We}from"./LocaleDropdown.7d1de440.js";import{_ as Ee}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as Fe}from"./i18n.a0f971c3.js";import"./use-dark.09fea322.js";import"./QSpace.2b47e780.js";import"./PostLocation.18462df1.js";import"./QLayout.f367b0a4.js";import"./TouchPan.81640d8c.js";import"./export-file.200e4ebe.js";import"./QForm.b5701193.js";import"./Functions.a6828b9d.js";import"./GoogleAutocomplete.1506f244.js";import"./UserFiles.b62f67b7.js";import"./QPage.04ecbe7a.js";import"./QPageContainer.58a868ff.js";import"./QEditor.2dc398a7.js";import"./QBtnDropdown.92e4f5d8.js";import"./UserCheckout.70f50a93.js";import"./UserReports.1bc0db70.js";import"./QPopupProxy.40be37ab.js";import"./QTr.5fbb2c40.js";import"./UserShare.9975d54e.js";import"./Auth.1fdd8b5e.js";const Me={components:{LocaleDropdown:We,Wish:Te,Post:Le},setup(){const y=Fe.global.t,r=Ye(),V=Be(),a=Ne(),z=m(!1),K=m(!1),Q=m(""),O=m(null),G=m(""),o=m(""),i=m(""),v=m(""),w=m([]),h=m({}),b=m(null),W=m({}),le=m(!1),te=m(!1),J=m(""),re=m(""),X=m(""),se=m(""),U=m("categoriesGetter"),ne=0,{crudAction:ie,notifyAction:k}=V,Z=_(()=>{var e,s;return(s=((e=V[U.value])==null?void 0:e.data)||[])==null?void 0:s.sort((t,c)=>{var p,g,f;return(f=(p=t==null?void 0:t.locales)==null?void 0:p.categoryName)==null?void 0:f.localeCompare((g=c==null?void 0:c.locales)==null?void 0:g.categoryName)})}),he=_(()=>{var e;return(e=V[U.value])==null?void 0:e.last_page}),$=_(()=>{var e;return(e=V.locationGetter)==null?void 0:e.location}),de=_(()=>{var e;return(e=V.distanceGetter)==null?void 0:e.distance}),ce=_(()=>{var e;return(e=V[U.value])==null?void 0:e.total}),we=_(()=>{var e;return(e=V.reloadGetter)==null?void 0:e.reload}),D=_(()=>{var e;return(e=V.configGetter)==null?void 0:e.locale}),ue=_(()=>V.authGetter),I=m({sortBy:"asc",descending:!1,page:1,rowsPerPage:ge(),rowsNumber:ce.value});Ve(()=>{a.name==="index"?_e():E(a)}),j(a,e=>E(e)),j(()=>r.screen.name,()=>I.value.rowsPerPage=ge()),j([$,D,de,we],()=>q({refresh:["reloadApp"]}).then(()=>E(a)));const me=[];j(re,e=>{I.value.page=1,a.params.posts=e,me.includes(e)||E(a),me.push(e)});function ge(){return ne}async function _e(){b.value.requestServerInteraction(),J.value="categories",q({}),X.value=y("categories")}function E(e){var s;if(e.query.page=I.value.page,e.query.method="get",e.name==="public.search.posts")X.value=y("search_result"),U.value=`${e.params.posts}`,ie({...e.query,search_posts:e.params.posts,url:"api/categories/searchPosts",mutate:U.value}).catch(t=>k({error:"Search.PostsAction",e:t}));else if(e.name==="public.category.id"||e.name==="public.subcategory.id"){const t=e.path.includes("subcategory"),c=$.value,p={...de.value,loc:c,locale:D.value,auth_id:(s=ue.value)==null?void 0:s.id},g=t?{subcategory_id:e.params.id}:{category_id:e.params.id},f=A=>A==null?void 0:A.forEach(u=>{X.value=u!=null&&u.subcategoryName?(u==null?void 0:u.categoryName)+" --> "+(u==null?void 0:u.subcategoryName):u==null?void 0:u.categoryName,se.value=u!=null&&u.subcategoryName?"/category/"+(u==null?void 0:u.category_id):"/"});e.params.posts&&(e.query.load=!0,e.query.FilterCategory=e.params.posts),U.value=e.path+"Getter",ie({...g,...p,...e.query,url:"api/categories/SubCategory",mutate:U.value}).then(({data:A})=>f(A)).catch(A=>k({error:"SubCategoryPostsAction",e:A}))}e.name!=="index"&&(J.value="category")}function Ce(e){var s,t;K.value=!0,Q.value=(s=e==null?void 0:e.locales)==null?void 0:s.categoryName,w.value=e==null?void 0:e.subcategories,G.value=(t=e==null?void 0:e.locales)==null?void 0:t.description,o.value=e.icon,h.value=e}return{height:_(()=>J.value!=="category"?null:screen.height/1.4),ipDebug:_(()=>{var e;return(e=V.configGetter)==null?void 0:e.ipDebug}),desktop:r.platform.is.desktop,tableRef:b,auth:ue,loading:z,popCategory:K,categoryName:Q,category_data:O,description:G,icon:o,link:se,subcategoryName:i,subcategory_data:v,filter:re,subcategories:w,getCategory:h,postData:W,view:le,baseURL:Re,timeago:ze,show:J,title:X,showAll:te,locale:D,cardContainerClass:_(()=>r.screen.gt.xs?"grid-masonry grid-masonry--"+(r.screen.gt.sm?"3":"2"):""),cardContainerStyle:_(()=>{var e;return{height:((e=Z.value)==null?void 0:e.length)*200+"px"}}),rowsPerPageOptions:_(()=>[ne]),viewPost(e){W.value=e,le.value=!0},subcategoryLangs:e=>e==null?void 0:e.locales,localeSubcategoryName:e=>e==null?void 0:e.subcategoryName,subcategoriesSorted(e){let s=[];return e==null||e.forEach(t=>{var p,g;const c=(p=t.posts)==null?void 0:p.filter(f=>new Date(f.end_date).getTime()>Date.now()?f.worldwide||f.location===$.value:"");(c.length||te.value)&&s.push({id:t.id,locales:[(g=t==null?void 0:t.locales)==null?void 0:g[0]],PostsNumber:c.length})}),s==null?void 0:s.sort((t,c)=>{var p,g,f,A,u;return(u=(g=(p=t==null?void 0:t.locales)==null?void 0:p[0])==null?void 0:g.subcategoryName)==null?void 0:u.localeCompare((A=(f=c==null?void 0:c.locales)==null?void 0:f[0])==null?void 0:A.subcategoryName)})},addCategory(){R({url:"api/categories",method:"post",data:{locale:D.value,categoryName:Q.value,description:G.value,icon:o.value}}).then(()=>{q({refresh:["reloadApp"]}),k({success:"Category Added Successfully"})}).catch(e=>{var s,t,c,p,g,f;return O.value=((p=(c=(t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.errors)==null?void 0:c.category)==null?void 0:p[0])||((f=(g=e==null?void 0:e.response)==null?void 0:g.data)==null?void 0:f.message)})},updateCategory(e){R({url:`api/categories/${e}`,method:"put",data:{locale:D.value,categoryName:Q.value,description:G.value,icon:o.value}}).then(()=>{q({refresh:["reloadApp"]}),k({success:"Category Updated Successfully"})}).catch(s=>k({error:"updateCategoryAction",e:s}))},editCategory:Ce,deleteCategory(e){const s=prompt("Please enter your password:");confirm("Are You Sure You Want To Delete Category")===!!s&&R({url:`api/categories/${e}`,method:"delete",data:{categoryName:1,password_confirmation:s}}).then(({data:{success:t}})=>{q({refresh:["reloadApp"]}),k({success:t})}).catch(t=>k({error:"deleteCategoryAction",e:t}))},addSubcategory(e){var s;R({url:"api/categories",method:"post",data:{locale:D.value,categoryID:e.id,subcategoryName:i.value,category_name:(s=e==null?void 0:e.locales)==null?void 0:s.categoryName}}).then(()=>{q({refresh:["reloadApp"]}),k({success:"Subcategory Added Successfully"})}).catch(t=>{var c,p,g,f;return v.value=((f=(g=(p=(c=t==null?void 0:t.response)==null?void 0:c.data)==null?void 0:p.errors)==null?void 0:g.subcategory)==null?void 0:f[0])||t.response.data.message})},updateSubcategory(e,s){R({url:`api/categories/${s}`,method:"put",data:{subcategoryID:s,locale:D.value,categoryID:e,subcategoryName:i.value,category_name:Q.value}}).then(()=>{q({refresh:["reloadApp"]}),k({success:"Subcategory Updated Successfully"})}).catch(t=>k({error:"updateSubcategoryAction",e:t}))},deleteSubcategory(e){const s=prompt("Please enter your password:");confirm("Are You Sure You Want To Delete Subcategory")===!!s&&R({url:`api/categories/${e}`,method:"delete",data:{subcategoryName:1,password_confirmation:s}}).then(({data:{success:t}})=>{q({refresh:["reloadApp"]}),k({success:t})}).catch(t=>k({error:"deleteCategoryAction",e:t}))},onScroll({to:e,ref:s}){var g;const t=((g=Z.value)==null?void 0:g.length)-1,c=he.value,p=I.value.page;z.value!==!0&&p<c&&e===t&&(z.value=!0,setTimeout(()=>{I.value.page++,a.query.load="true",E(a),Se(()=>{s.refresh(),z.value=!1})},500)),console.log("page",I.value.page,"<","lastPage",c,"to",e,"===",t,"lastIndex",">",0,"total",ce.value)},columns:[{name:"pic",align:"left",label:y("picture"),field:"pic",sortable:!1},{name:"post_title",align:"left",label:"Post Title",field:"post_title",sortable:!0},{name:"description",align:"center",label:"description",field:"description",sortable:!0},{name:"address",align:"left",label:"Address",field:"address",sortable:!0},{name:"city",align:"left",label:"City",field:"city",sortable:!0},{name:"postal_code",align:"left",label:"Postal Code",field:"postal_code",sortable:!0}],rows:Z,pagination:I}}},Oe={key:0,dense:""},Je={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Xe={key:1},je={key:2,class:"row"},He={class:"col-md-12"},Ke={key:0},Ze={class:"q-pa-md q-gutter-md"},$e={class:"text-weight-medium"},ea={class:"text-grey-8"},aa={key:0,class:"text-grey-8 q-pa-md"},oa={key:0,class:"timestamp timeago q-pa-md"},la={class:"text-grey-8 q-gutter-xs"};function ta(y,r,V,a,z,K){const Q=ee("locale-dropdown"),O=ee("Post"),G=ee("wish");return d(),C(F,null,[l(ye,{modelValue:a.popCategory,"onUpdate:modelValue":r[5]||(r[5]=o=>a.popCategory=o)},{default:n(()=>[l(oe,{class:"my-card col-12"},{default:n(()=>[l(P,{class:"q-ma-xs",clearable:"",rounded:"",outlined:"",modelValue:a.categoryName,"onUpdate:modelValue":r[3]||(r[3]=o=>a.categoryName=o),label:y.$t("update_category_name")},{append:n(()=>[l(P,{clearable:"",square:"",outlined:"",modelValue:a.description,"onUpdate:modelValue":r[0]||(r[0]=o=>a.description=o),label:y.$t("update_description")},null,8,["modelValue","label"]),l(P,{clearable:"",square:"",outlined:"",modelValue:a.icon,"onUpdate:modelValue":r[1]||(r[1]=o=>a.icon=o),label:y.$t("update_icon")},null,8,["modelValue","label"]),l(Q),l(N,{class:"glossy",dense:"",loading:a.loading,icon:"fas fa-floppy-disk",onClick:r[2]||(r[2]=T(o=>a.updateCategory(a.getCategory.id),["prevent"]))},null,8,["loading"]),xe(l(N,{class:"float-right q-ml-xs",dense:"",round:"",icon:"close"},null,512),[[ke]])]),_:1},8,["modelValue","label"]),l(fe),a.getCategory.subcategories?(d(),C("div",Oe,[(d(!0),C(F,null,H(a.getCategory.subcategories,(o,i)=>(d(),C("div",{key:i},[(d(!0),C(F,null,H(o.locales,(v,w)=>(d(),x(P,{class:"q-ma-xs",clearable:"",key:w,rounded:"",outlined:"",modelValue:a.subcategoryName,"onUpdate:modelValue":r[4]||(r[4]=h=>a.subcategoryName=h),hint:v==null?void 0:v.subcategoryName,label:y.$t("update_subcategory_name")},{append:n(()=>[l(N,{class:"glossy",dense:"",loading:a.loading,icon:"fas fa-floppy-disk",onClick:T(h=>a.updateSubcategory(o.category_id,o.id),["prevent"])},null,8,["loading","onClick"])]),_:2},1032,["modelValue","hint","label"]))),128))]))),128))])):S("",!0)]),_:1})]),_:1},8,["modelValue"]),l(ye,{modelValue:a.view,"onUpdate:modelValue":r[6]||(r[6]=o=>a.view=o)},{default:n(()=>[l(oe,{class:"my-card col-12",style:{width:"1250px"}},{default:n(()=>[l(O,{postData:a.postData},null,8,["postData"])]),_:1})]),_:1},8,["modelValue"]),l(De,{flat:"",bordered:"","hide-header":"",ref:"tableRef","row-key":"name",style:Pe(`height: ${a.height}px`),title:a.title,"card-container-class":a.cardContainerClass,"card-container-style":a.cardContainerStyle,grid:a.show==="categories",rows:a.rows,columns:a.columns,filter:a.filter,"rows-per-page-options":[a.rowsPerPageOptions],loading:a.loading,"virtual-scroll":"","virtual-scroll-item-size":150,"virtual-scroll-sticky-size-start":150,pagination:a.pagination,"onUpdate:pagination":r[13]||(r[13]=o=>a.pagination=o),onVirtualScroll:a.onScroll},Ae({"top-right":n(()=>{var o;return[a.show==="category"?(d(),x(P,{key:0,clearable:"",borderless:"",dense:"",debounce:"300",modelValue:a.filter,"onUpdate:modelValue":r[7]||(r[7]=i=>a.filter=i),placeholder:y.$t("search")},{append:n(()=>[l(pe,{name:"search"})]),_:1},8,["modelValue","placeholder"])):S("",!0),((o=a.auth)==null?void 0:o.role)==="Admin"&&a.show==="categories"?(d(),x(P,{key:1,clearable:"",rounded:"",outlined:"",modelValue:a.categoryName,"onUpdate:modelValue":r[11]||(r[11]=i=>a.categoryName=i),label:y.$t("add_category")},{append:n(()=>[l(P,{clearable:"",square:"",outlined:"",modelValue:a.description,"onUpdate:modelValue":r[8]||(r[8]=i=>a.description=i),label:y.$t("add_description")},null,8,["modelValue","label"]),l(qe,{modelValue:a.showAll,"onUpdate:modelValue":r[9]||(r[9]=i=>a.showAll=i),label:"All"},null,8,["modelValue"]),l(P,{clearable:"",square:"",outlined:"",modelValue:a.icon,"onUpdate:modelValue":r[10]||(r[10]=i=>a.icon=i),label:y.$t("add_icon")},null,8,["modelValue","label"]),l(N,{class:"glossy q-ml-md",dense:"",round:"",loading:a.loading,icon:"fas fa-plus-circle",onClick:T(a.addCategory,["prevent"]),error:!!a.category_data,"error-message":a.category_data},null,8,["loading","onClick","error","error-message"])]),_:1},8,["modelValue","label"])):S("",!0)]}),_:2},[a.show==="categories"?{name:"item",fn:n(o=>[Y("div",Je,[l(oe,{class:"q-pa-xs"},{default:n(()=>[l(Ue,{class:"text-center"},{default:n(()=>{var i,v,w,h;return[l(N,{class:"q-ma-xs",flat:"",icon:o.row.icon,label:((i=o.row.locales)==null?void 0:i.categoryName)||y.$t("Translation Not Available Yet"),to:"/category/"+o.row.id},null,8,["icon","label","to"]),(v=o.row.locales)!=null&&v.description?(d(),x(N,{key:0,flat:"",round:"",icon:"fas fa-question"},{default:n(()=>[l(Qe,{anchor:"top middle",self:"bottom middle",offset:[10,10],class:"text-h6"},{default:n(()=>{var b;return[ae(L((b=o.row.locales)==null?void 0:b.description),1)]}),_:2},1024)]),_:2},1024)):S("",!0),((w=a.auth)==null?void 0:w.role)==="Admin"?(d(),C("span",Xe,[l(N,{class:"glossy",dense:"",loading:a.loading,icon:"fas fa-edit",onClick:T(b=>a.editCategory(o.row),["prevent"])},null,8,["loading","onClick"]),l(N,{class:"glossy",dense:"",loading:a.loading,icon:"fas fa-trash-alt",onClick:T(b=>a.deleteCategory(o.row.id),["prevent"])},null,8,["loading","onClick"])])):S("",!0),((h=a.auth)==null?void 0:h.role)==="Admin"?(d(),C("div",je,[Y("div",He,[l(P,{rounded:"",outlined:"",modelValue:a.subcategoryName,"onUpdate:modelValue":r[12]||(r[12]=b=>a.subcategoryName=b),label:y.$t("add_subcategory"),clearable:"",error:!!a.subcategory_data,"error-message":a.subcategory_data},{append:n(()=>[o.row.id?(d(),C("div",Ke,[l(N,{class:"glossy",dense:"",round:"",loading:a.loading,icon:"fas fa-plus-circle",onClick:T(b=>a.addSubcategory(o.row),["prevent"])},null,8,["loading","onClick"])])):S("",!0)]),_:2},1032,["modelValue","label","error","error-message"])])])):S("",!0)]}),_:2},1024),l(fe),l(ve,{dense:""},{default:n(()=>[(d(!0),C(F,null,H(a.subcategoriesSorted(o.row.subcategories),(i,v)=>(d(),C("div",{key:v},[l(be,{clickable:"",tag:"a",to:"/subcategory/"+i.id},{default:n(()=>{var w;return[l(M,null,{default:n(()=>[(d(!0),C(F,null,H(a.subcategoryLangs(i),(h,b)=>(d(),x(B,{key:b},{default:n(()=>[ae(L(a.localeSubcategoryName(h)||y.$t("Translation Not Available Yet")),1)]),_:2},1024))),128))]),_:2},1024),l(M,{side:""},{default:n(()=>[l(B,{caption:""},{default:n(()=>[ae(L(i.PostsNumber),1)]),_:2},1024)]),_:2},1024),((w=a.auth)==null?void 0:w.role)==="Admin"?(d(),x(N,{key:0,class:"glossy q-ml-md",dense:"",loading:a.loading,icon:"fas fa-trash-alt",onClick:T(h=>a.deleteSubcategory(i.id),["prevent"])},null,8,["loading","onClick"])):S("",!0)]}),_:2},1032,["to"])]))),128))]),_:2},1024)]),_:2},1024)])]),key:"0"}:{name:"body",fn:n(o=>[Y("div",Ze,[l(ve,{bordered:"",class:"rounded-borders",style:{"max-width":"1600px"}},{default:n(()=>[l(be,null,{default:n(()=>[l(M,{style:{"max-width":"150px","max-height":"150px",cursor:"pointer"},onClick:i=>a.viewPost(o.row)},{default:n(()=>{var i,v,w,h,b,W;return[(w=(v=(i=o.row)==null?void 0:i.pics)==null?void 0:v[0])!=null&&w.pic?(d(),x(Ie,{key:0,src:a.baseURL+"/"+((W=(b=(h=o.row)==null?void 0:h.pics)==null?void 0:b[0])==null?void 0:W.pic)},null,8,["src"])):(d(),x(pe,{key:1,name:"fas fa-plus-circle",color:"black",size:"150px"}))]}),_:2},1032,["onClick"]),l(M,null,{default:n(()=>[l(B,{lines:"1"},{default:n(()=>[Y("span",$e,L(o.row.city),1),Y("span",ea,L(o.row.postal_code),1)]),_:2},1024),l(B,{lines:"1",class:"q-mt-xs text-body2 text-weight-bold text-primary text-uppercase"},{default:n(()=>[l(N,{flat:"",label:o.row.post_title,to:"/post/"+o.row.id},null,8,["label","to"])]),_:2},1024),l(B,{caption:"",lines:"1"},{default:n(()=>[o.row.price>0?(d(),C("span",aa,L(Number(o.row.price).toLocaleString(a.locale,{style:"currency",currency:o.row.currency_code||"USD"})),1)):S("",!0)]),_:2},1024),l(B,{caption:"",lines:"1"},{default:n(()=>[a.ipDebug?(d(),C("small",oa,L(a.timeago(o.row.start_date)),1)):S("",!0)]),_:2},1024)]),_:2},1024),l(M,{side:""},{default:n(()=>[Y("div",la,[l(G,{post:o.row},null,8,["post"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),key:"1"}]),1032,["style","title","card-container-class","card-container-style","grid","rows","columns","filter","rows-per-page-options","loading","pagination","onVirtualScroll"]),l(Ge,{position:a.desktop?"top":"bottom-right",offset:[18,18]},{default:n(()=>[a.link?(d(),x(N,{key:0,fab:"",icon:"fas fa-undo",to:a.link},null,8,["to"])):S("",!0)]),_:1},8,["position"])],64)}var za=Ee(Me,[["render",ta]]);export{za as default};
