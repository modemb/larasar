import{aw as ie,c as D,o as de,C as pe,af as t,ag as _,ap as ye,F as G,am as y,ao as C,an as h,ak as f,at as he,r as c,k as we,aS as ve,ae as be,al as b,f as d,Q as se,ah as M,ai as Q,K as ke,aq as _e,aj as z,ay as T}from"./index.a0547624.js";import{Q as Ce,a as Ve}from"./QBar.75ffc9b0.js";import{a as Qe,b as qe}from"./QLayout.744b3411.js";import{Q as Ue,t as Ae}from"./QCheckbox.b19fbb11.js";import{Q as E,C as Ee}from"./ClosePopup.80a36c56.js";import{Q as Le}from"./QCardSection.f50f26ff.js";import{Q as Se}from"./QCard.0993d832.js";import{Q as Pe}from"./QForm.a37ec1ca.js";import{Q as De}from"./QPage.b007acfe.js";import{Q as Me}from"./QPageContainer.80b08606.js";import{u as ue,a as A,n as me,j as K,f as Be,M as Ie,o as We,p as Fe,e as je,x as Re}from"./axios.f7466c17.js";import{c as ze}from"./Functions.1e50194a.js";import{_ as ce}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as H}from"./i18n.184d27f4.js";import"./use-dark.8f226bc0.js";const Ke={name:"LoginWithSocial",setup(){var l,L;const a=ie(),r=ue(),{notifyAction:i}=r,e=(L=(l=H)==null?void 0:l.global)==null?void 0:L.t,q=D(()=>r.authGetter);de(()=>{a.params.driver&&A.get(`/api/login/${a.params.driver}/callback`,{params:a.query}).then(({data:s},v=s)=>{v.remember||(v={access_token:"$provider",remember:!0,expires_in:365}),window.opener.postMessage({token:v},window.location.href),window.close()}).catch(s=>i({error:"LoginWithSocial",e:s})),window.addEventListener("message",u,!1)}),pe(()=>window.removeEventListener("message",u));async function w(s){const v=K||k("",e("login")),{data:{url:g}}=await A.post(`/api/login/${s}`).catch(V=>i({error:"logProvider",e:V}));try{K?await ze().Browser.open({url:g}):v.location.href=g}catch(V){i({error:"openBrowser",e:V})}}function u(s){!s.data.token||s.origin!==window.origin||me({token:s.data.token,remember:!0})}function k(s,v,g={}){typeof s=="object"&&(g=s,s=""),g={url:s,title:v,width:600,height:720,...g};const V=window.screenLeft!==void 0?window.screenLeft:window.screen.left,B=window.screenTop!==void 0?window.screenTop:window.screen.top,I=window.innerWidth||document.documentElement.clientWidth||window.screen.width,W=window.innerHeight||document.documentElement.clientHeight||window.screen.height;g.left=I/2-g.width/2+V,g.top=W/2-g.height/2+B;const F=Object.keys(g).reduce((S,P)=>(S.push(`${P}=${g[P]}`),S),[]).join(","),U=window.open(s,v,F);return"focus"in window&&(U==null||U.focus()),U}return{drivers:["github"],mobileApp:K,ipDebug:D(()=>{var s;return(s=r.configGetter)==null?void 0:s.ipDebug}),async login(s){q.value?(Be(),setTimeout(()=>w(s),1500)):w(s)}}}};function Te(a,r,i,e,q,w){return t(!0),_(G,null,ye(e.drivers,(u,k)=>(t(),_("span",{key:k},[!e.mobileApp||e.ipDebug?(t(),y(h,{key:0,color:"primary",class:"q-ma-sm col-lg-3",icon:"fab fa-"+u,label:a.$t("login_with"),onClick:C(l=>e.login(u),["prevent"])},null,8,["icon","label","onClick"])):f("",!0)]))),128)}var Ge=ce(Ke,[["render",Te]]);const He={components:{LoginWithSocial:Ge},name:"registerPage",props:["auth"],setup(a){var J,X,Z,$,x;const r=(X=(J=H)==null?void 0:J.global)==null?void 0:X.t,i=ie(),e=he(),q=ue(),{notifyAction:w}=q,u=c(!1),k=c(""),l=c(""),L=c(!1),s=c(null),v=c(null),g=c(null),V=c(null),B=c(null),I=c(null),W=c(i.query.email||null),F=c(null),U=c(null),S=c(null),P=c(null),N=c(!0),fe=D(()=>{var m;return(m=q.configGetter)==null?void 0:m.ipDebug}),O=D(()=>q.authGetter),j=we({app:K,auth:a.auth,role:s,first_name:g,last_name:B,email:W,password:U,password_confirmation:P,remember:N,locale:($=(Z=H)==null?void 0:Z.global)==null?void 0:$.locale.value,token:i.query.token||i.params.token||"csrf",device_name:(x=navigator.userAgent.match(/\(([^)]+)\)/))==null?void 0:x[1].split(";")[0].split(" ")[0]});de(()=>{}),ve(()=>Y(i));function Y(m){const n="api/users";m.params.id||m.path.includes("email/verify")&&A({url:n,method:"post",data:{token:"csrf"}}).then(()=>w({success:"verify_email_address"})).catch(o=>w({error:"resendAction",e:o}))}function ge(m){u.value=!0,k.value?A({url:"api/users",method:"post",data:{code:k.value,token:"csrf"}}).then(n=>{var o;console.log("token",n),u.value=L.value=!1,(o=je())==null||o.then(()=>e.push({path:"/profile"})),Re(O.value),w({success:"Email Verified Successfully"})}).catch(n=>R(n)):u.value=!1}function R(m){var ee,ae,le,re,oe,ne,te;const n=(ee=m==null?void 0:m.response)==null?void 0:ee.data;u.value=!1;const o=n==null?void 0:n.errors;let p=n==null?void 0:n.message;p!=null&&p.includes("CSRF")&&(p="error_alert_text"),v.value=r(((ae=o==null?void 0:o.role)==null?void 0:ae[0])||p),V.value=r(((le=o==null?void 0:o.first_name)==null?void 0:le[0])||p),I.value=r(((re=o==null?void 0:o.last_name)==null?void 0:re[0])||p),F.value=r((n==null?void 0:n.email)||((oe=o==null?void 0:o.email)==null?void 0:oe[0])||p),S.value=r(((ne=o==null?void 0:o.password)==null?void 0:ne[0])||p),l.value=((te=o==null?void 0:o.code)==null?void 0:te[0])||p}return{verifyEmail:D(()=>{var m;return(m=O.value)==null?void 0:m.email}),MAIL_VERIFY:Ie,MAIL_CODE:We,code:k,ipDebug:fe,param_id:L,verify_email_data:l,loader:u,role:s,role_data:v,first_name:g,first_name_data:V,last_name:B,last_name_data:I,email:W,email_data:F,password:U,password_data:S,password_confirmation:P,isPwd:c(!0),remember:N,privacy:c(!1),admins:["Admin","User","Editor"],users:["User","Editor"],authenticateUser(){var n,o;const m=(n=i.path)!=null&&n.includes("login")?"login":(o=i.path)!=null&&o.includes("register")?"api/register":"api/users";A.post(m,j).then(({data:p})=>{u.value=!1,i.path==="/register"?e.push({path:"/login"}).then(()=>w({success:p})):me({token:p,remember:j.remember})}).catch(p=>R(p)),u.value=!0},send(){const m="forgot-password";A.post(m,j).then(({data:n})=>{console.log("send",n),u.value=!1,w({success:n.message})}).catch(n=>R(n)),u.value=!0},reset(){u.value=!0;const m="reset-password";A.post(m,j).then(()=>{u.value=!1,e.push({path:"/login"}).then(()=>w({success:"password_updated"}))}).catch(n=>R(n))},resend:Y,verify:ge,deleteAllCookies:Fe}}},Ne={key:0,class:"q-pa-sm"},Oe={key:1,class:"row flex justify-center"},Ye={class:"text-h6"},Je={class:"q-ma-sm q-dark"},Xe=M("br",null,null,-1),Ze={key:0,class:"q-ma-sm"},$e=M("br",null,null,-1);function xe(a,r,i,e,q,w){const u=be("LoginWithSocial");return t(),y(Qe,{view:"lHh lpr lFf",container:"",style:{height:"700px"},class:"shadow-2 rounded-borders"},{default:b(()=>[i.auth?(t(),y(qe,{key:0,elevated:""},{default:b(()=>[d(Ve,null,{default:b(()=>[d(se,{name:"fas fa-user"}),M("div",null,Q(a.$t("add_user")),1),d(Ce),ke(d(h,{dense:"",flat:"",icon:"close"},null,512),[[Ee]])]),_:1})]),_:1})):f("",!0),d(Me,null,{default:b(()=>[d(De,{class:_e(i.auth||"flex flex-center *q-pa-md")},{default:b(()=>[d(Pe,{class:"q-gutter-md"},{default:b(()=>{var k;return[a.$route.path.includes("email/verify")?f("",!0):(t(),_("div",Ne,[i.auth?(t(),y(Ue,{key:0,filled:"",class:"col-12",modelValue:e.role,"onUpdate:modelValue":r[0]||(r[0]=l=>e.role=l),options:i.auth.id==1||((k=i.auth)==null?void 0:k.role)=="Admin"?e.admins:e.users,label:a.$t("role"),error:!!e.role_data,"error-message":e.role_data},null,8,["modelValue","options","label","error","error-message"])):f("",!0),i.auth||(e.privacy=a.$route.path.includes("register"))?(t(),y(E,{key:1,filled:"",clearable:"",modelValue:e.first_name,"onUpdate:modelValue":r[1]||(r[1]=l=>e.first_name=l),label:a.$t("first_name"),"lazy-rules":"",rules:[l=>l&&l.length>0||"null"],error:!!e.first_name_data,"error-message":e.first_name_data},null,8,["modelValue","label","rules","error","error-message"])):f("",!0),i.auth||a.$route.path.includes("register")?(t(),y(E,{key:2,filled:"",clearable:"",modelValue:e.last_name,"onUpdate:modelValue":r[2]||(r[2]=l=>e.last_name=l),label:a.$t("last_name"),"lazy-rules":"",rules:[l=>l&&l.length>0||"null"],error:!!e.last_name_data,"error-message":e.last_name_data},null,8,["modelValue","label","rules","error","error-message"])):f("",!0),d(E,{filled:"",type:"email",modelValue:e.email,"onUpdate:modelValue":r[3]||(r[3]=l=>e.email=l),"lazy-rules":"","bottom-slots":"",clearable:"",label:a.$t("email"),autocomplete:"on",rules:[l=>l&&l.length>0||"null"],error:!!e.email_data,"error-message":e.email_data},null,8,["modelValue","label","rules","error","error-message"]),a.$route.path.includes("password/email")?f("",!0):(t(),y(E,{key:3,modelValue:e.password,"onUpdate:modelValue":r[5]||(r[5]=l=>e.password=l),filled:"","lazy-rules":"",label:a.$t("password"),clearable:"",type:e.isPwd?"password":"text",rules:[l=>l&&l.length>7||"min 8"],error:!!e.password_data,"error-message":e.password_data},{append:b(()=>[d(se,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:r[4]||(r[4]=l=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","label","type","rules","error","error-message"])),i.auth||a.$route.path.includes("register")||a.$route.path.includes("reset-password")?(t(),y(E,{key:4,modelValue:e.password_confirmation,"onUpdate:modelValue":r[6]||(r[6]=l=>e.password_confirmation=l),filled:"",type:e.isPwd?"password":"text",label:a.$t("confirm_password"),clearable:"",rules:[l=>l&&l.length>7||"min 8"]},null,8,["modelValue","type","label","rules"])):f("",!0)])),a.$route.path.includes("email/verify")?(t(),_("div",Oe,[d(Se,{class:"my-card text-white"},{default:b(()=>[d(Le,{class:"bg-primary"},{default:b(()=>[M("div",Ye,Q(a.$t("verify_email"))+" "+Q(e.verifyEmail),1)]),_:1}),M("div",Je,[a.success?(t(),_(G,{key:0},[z(Q(a.$t("verify_email_address"))+" ",1),Xe],64)):f("",!0),e.param_id?(t(),_(G,{key:1},[z(Q(a.$t("failed_to_verify_email")),1)],64)):f("",!0),z(" "+Q(a.$t("before_email_verification"))+" "+Q(a.$t("receive_email"))+", ",1)]),d(h,{color:"primary",class:"q-ma-sm",label:a.$t("resend_verification"),onClick:r[7]||(r[7]=C(l=>e.resend(a.$route),["prevent"]))},null,8,["label"]),e.MAIL_VERIFY&&e.param_id?(t(),y(h,{key:0,color:"primary",class:"q-ma-sm",loading:e.loader,label:a.$t("verify_email"),onClick:r[8]||(r[8]=C(l=>e.verify(a.$route),["prevent"]))},null,8,["loading","label"])):f("",!0),e.MAIL_CODE?(t(),y(E,{key:1,clearable:"",outlined:"",modelValue:e.code,"onUpdate:modelValue":r[10]||(r[10]=l=>e.code=l),label:a.$t("Enter Code"),counter:"",maxlength:"4",class:"q-ma-sm",rules:[l=>l&&l.length>0||"null"],error:!!e.verify_email_data,"error-message":e.verify_email_data},{append:b(()=>[d(h,{round:"",dense:"",flat:"",loading:e.loader,icon:"send",onClick:r[9]||(r[9]=C(l=>e.verify(a.$route),["prevent"]))},null,8,["loading"])]),_:1},8,["modelValue","label","rules","error","error-message"])):f("",!0)]),_:1})])):f("",!0),a.$route.path.includes("reset-password")?(t(),_("div",{key:2,onKeyup:r[11]||(r[11]=T((...l)=>e.reset&&e.reset(...l),["enter"]))},[d(h,{color:"primary",icon:"fas fa-history",loading:e.loader,label:a.$t("reset_password"),onClick:C(e.reset,["prevent"])},null,8,["loading","label","onClick"])],32)):!a.$route.path.includes("password/email")&&!a.$route.path.includes("email/verify")?(t(),_("div",{key:3,onKeyup:r[13]||(r[13]=T((...l)=>e.authenticateUser&&e.authenticateUser(...l),["enter"]))},[e.privacy?(t(),_("div",Ze,[d(h,{flat:"",label:a.$t("posting-policies"),to:"page/posting-policies"},null,8,["label"]),d(h,{flat:"",label:a.$t("privacy-policy"),to:"page/privacy-policy"},null,8,["label"]),$e,z(" "+Q(a.$t("posting-&-privacy")),1)])):f("",!0),a.$route.path.includes("login")?(t(),y(h,{key:1,color:"primary",class:"q-ma-sm",icon:"fas fa-sign-in-alt",loading:e.loader,label:a.$t("login"),onClick:C(e.authenticateUser,["prevent"])},null,8,["loading","label","onClick"])):(t(),y(h,{key:2,color:"primary",class:"q-ma-sm",icon:"fas fa-plus-circle",loading:e.loader,label:i.auth?a.$t("add_user"):a.$t("register"),onClick:C(e.authenticateUser,["prevent"])},null,8,["loading","label","onClick"])),e.ipDebug?(t(),y(h,{key:3,color:"primary",class:"q-ma-sm",loading:e.loader,icon:"fas fa-sync",label:a.$t("reset"),onClick:C(e.deleteAllCookies,["prevent"])},null,8,["loading","label","onClick"])):f("",!0),a.$route.path.includes("register")?(t(),y(h,{key:4,flat:"",dense:"",_color:"primary",label:a.$t("login"),to:"/login"},null,8,["label"])):i.auth?f("",!0):(t(),y(h,{key:5,flat:"",dense:"",_color:"primary",label:a.$t("register"),to:"/register"},{default:b(()=>[d(h,{flat:"",dense:"",_color:"primary",label:a.$t("forgot_password"),to:"/password/email"},null,8,["label"]),d(Ae,{modelValue:e.remember,"onUpdate:modelValue":r[12]||(r[12]=l=>e.remember=l),label:a.$t("remember_me")},null,8,["modelValue","label"])]),_:1},8,["label"]))],32)):a.$route.path.includes("password/email")?(t(),_("div",{key:4,onKeyup:r[14]||(r[14]=T((...l)=>e.send&&e.send(...l),["enter"]))},[d(h,{color:"primary",class:"q-ma-sm",label:a.$t("send_password_reset_link"),loading:e.loader,icon:"fas fa-link",onClick:C(e.send,["prevent"])},null,8,["label","loading","onClick"])],32)):f("",!0),d(u)]}),_:1})]),_:1},8,["class"])]),_:1})]),_:1})}var pa=ce(He,[["render",xe]]);export{pa as default};
