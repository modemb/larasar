import{r as _,c as g,w as B,o as O,af as k,ag as P,f as o,b8 as G,al as r,b9 as K,an as p,am as V,ah as z,K as j,ak as A,aj as d,ai as u,Q as F}from"./index.13c3f144.js";import{Q as J}from"./QToggle.3517a43d.js";import{d as L,e as W,Q as H}from"./export-file.2729cbf1.js";import{Q as X}from"./QPopupProxy.8891f933.js";import{b as Z,c as $}from"./QTable.067c00e4.js";import{Q as ee}from"./QTooltip.d9557058.js";import{Q as te,C as q}from"./ClosePopup.1bf598b3.js";import{Q as ae,a as m}from"./QTr.09fa586b.js";import{u as le}from"./use-quasar.46364531.js";import{u as ne,k as oe,x as re}from"./axios.3783d787.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as se}from"./i18n.a7c38d7c.js";import"./QCheckbox.9bc58682.js";import"./use-dark.eef62c6b.js";import"./QSeparator.fa2931ea.js";function E(l,n){let i=n!==void 0?n(l):l;return i=i==null?"":String(i),i=i.split('"').join('""'),`"${i}"`}const de={props:["post_id","pending_payments","post_reports","users_reports"],setup(l){var N,S;const n=(S=(N=se)==null?void 0:N.global)==null?void 0:S.t,i=le(),a=ne(),{crudAction:C,notifyAction:x}=a,e=Date.now(),y=L.formatDate(e,"YYYY/MM/DD"),v=_(y),h=_("today"),R=_(!1),f=_([]),U=g(()=>l==null?void 0:l.pending_payments),T=g(()=>{var t;return(t=a.configGetter)==null?void 0:t.ipDebug}),w=g(()=>a.authGetter),Y=g(()=>l==null?void 0:l.post_id),I=Object.fromEntries(Object.entries(w.value||{}).filter(([t])=>t.includes("id")));B([Y,U],()=>D(""));const Q=g(()=>[{name:"id",align:"center",label:"ID",field:"id",sortable:!0},{name:"product",align:"center",label:n("product"),field:"product",sortable:!0},{name:"first_name",align:"center",label:n("first_name"),field:"first_name",sortable:!0},{name:"last_name",align:"center",label:n("last_name"),field:"last_name",sortable:!0},{name:"sale_date",align:"center",label:n("sale_date"),field:"sale_date",sortable:!0},{name:"start_date",align:"center",label:n("start_date"),field:"start_date",sortable:!0},{name:"end_date",align:"center",label:n("end_date"),field:"end_date",sortable:!0},{name:"plan",align:"center",label:n("plan"),field:"plan",sortable:!0},{name:"payment",align:"center",label:n("payment"),field:"payment",sortable:!0},{name:"amount",align:"center",label:n("amount"),field:"amount",sortable:!0},{name:"paymentAmount",align:"center",label:n("paymentAmount"),field:"paymentAmount",sortable:!0}].concat(T.value?[{name:"total",align:"center",label:n("total"),field:"total",sortable:!0},{name:"currency_code",align:"center",label:n("currency_code"),field:"currency_code",sortable:!0}]:[]));function M(t){C({...t,...I}).then(s=>f.value=s).catch(s=>x({error:"reportsAction",e:s}))}B(h,t=>!t||D(t));function D(t){var s;if(l.pending_payments)return f.value=l.pending_payments;if(l.users_reports)return f.value=l.users_reports;if(l.post_reports)return f.value=l.post_reports;M({mutate:"reportsGetter"+t,url:"api/users/reports",method:"get",post_id:(l==null?void 0:l.post_id)||0,role:(s=w.value)==null?void 0:s.role,period:t})}return O(()=>D(h.value)),{ipDebug:T,filter:_(""),loading:R,rows:f,columns:Q,height:_(screen.height/1.4),period:h,range:_(!1),auth:w,cy:oe,xRate:re,total:g(()=>{var s;let t=0;return(s=f.value)==null||s.forEach(c=>t+=Number(c==null?void 0:c.amount)),t}),amount:g(()=>{var s;let t=0;return(s=f.value)==null||s.forEach(c=>t+=Number(c==null?void 0:c.paymentAmount)),t}),proxyDate:v,save(){h.value="",M({expandingRow:!0,url:"api/users/reports",method:"get",from:v.value.from,to:v.value.to,proxyDate:v.value})},fnum(t){return isNaN(t)||t<9999?t:t<1e6?Math.round(t/1e3)+"K":t<1e7?(t/1e6).toFixed(2)+"M":t<1e9?Math.round(t/1e6)+"M":t<1e12?Math.round(t/1e9)+"B":"1T+"},exportTable(){const t=[Q.value.map(c=>E(c.label))].concat(f.value.map(c=>Q.value.map(b=>E(typeof b.field=="function"?b.field(c):c[b.field===void 0?b.name:b.field],b.format)).join(","))).join(`\r
`);W("table-export.csv",t,"text/csv")!==!0&&i.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},pagination:{}}}},ue={class:"q-pa-md"},me={class:"row items-center justify-end q-gutter-sm"};function ce(l,n,i,a,C,x){return k(),P("div",ue,[o(Z,{style:K("height:"+a.height+"px"),class:"my-sticky-virtscroll-table",title:`${l.$t("reports")}: ${a.cy(a.xRate(a.total))} - ${l.$t("paymentAmount")}: ${a.cy(a.xRate(a.amount))}`,rows:a.rows,columns:a.columns,"row-key":"name",ref:"table",loading:a.loading,filter:a.filter,"binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0],"virtual-scroll-sticky-size-start":48,pagination:a.pagination,"onUpdate:pagination":n[4]||(n[4]=e=>a.pagination=e)},G({body:r(e=>[o(ae,{props:e},{default:r(()=>[o(m,{key:"id",props:e},{default:r(()=>[d(u(e.row.id),1)]),_:2},1032,["props"]),o(m,{key:"product",props:e},{default:r(()=>[o(p,{color:"primary",to:"/post/"+e.row.post_id,label:e.row.product||e.row.post_id},null,8,["to","label"])]),_:2},1032,["props"]),o(m,{key:"first_name",props:e},{default:r(()=>{var y;return[d(u((y=e.row.user)==null?void 0:y.first_name),1)]}),_:2},1032,["props"]),o(m,{key:"last_name",props:e},{default:r(()=>{var y;return[d(u((y=e.row.user)==null?void 0:y.last_name),1)]}),_:2},1032,["props"]),o(m,{key:"sale_date",props:e},{default:r(()=>[d(u(e.row.sale_date),1)]),_:2},1032,["props"]),o(m,{key:"start_date",props:e},{default:r(()=>[d(u(e.row.start_date),1)]),_:2},1032,["props"]),o(m,{key:"end_date",props:e},{default:r(()=>[d(u(e.row.end_date),1)]),_:2},1032,["props"]),o(m,{key:"plan",props:e},{default:r(()=>[d(u(e.row.plan),1)]),_:2},1032,["props"]),o(m,{key:"payment",props:e},{default:r(()=>[d(u(e.row.payment),1)]),_:2},1032,["props"]),o(m,{key:"amount",props:e},{default:r(()=>[d(u(e.row.amount),1)]),_:2},1032,["props"]),o(m,{key:"paymentAmount",props:e},{default:r(()=>[d(u(e.row.paymentAmount),1)]),_:2},1032,["props"]),a.ipDebug?(k(),V(m,{key:"total",props:e},{default:r(()=>[d(u(e.row.total),1)]),_:2},1032,["props"])):A("",!0),o(m,{key:"currency_code",props:e},{default:r(()=>[d(u(e.row.currency_code),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:2},[i.post_id||i.users_reports||i.pending_payments?void 0:{name:"top-right",fn:r(()=>[o(p,{color:"primary","icon-right":"archive",label:l.$t("export_to_csv"),"no-caps":"",onClick:a.exportTable},null,8,["label","onClick"]),i.post_reports?A("",!0):(k(),V(p,{key:0,color:"primary",class:"q-ma-xs",icon:"event",label:JSON.stringify(a.proxyDate)},{default:r(()=>[o(X,{"transition-show":"scale","transition-hide":"scale"},{default:r(()=>[o(H,{modelValue:a.proxyDate,"onUpdate:modelValue":n[1]||(n[1]=e=>a.proxyDate=e),range:a.range},{default:r(()=>[z("div",me,[j(o(p,{label:"Cancel",color:"primary",flat:""},null,512),[[q]]),o(J,{modelValue:a.range,"onUpdate:modelValue":n[0]||(n[0]=e=>a.range=e),label:"Range"},null,8,["modelValue"]),j(o(p,{label:"OK",color:"primary",flat:"",onClick:a.save},null,8,["onClick"]),[[q]])])]),_:1},8,["modelValue","range"])]),_:1})]),_:1},8,["label"])),i.post_reports?A("",!0):(k(),V($,{key:1,modelValue:a.period,"onUpdate:modelValue":n[2]||(n[2]=e=>a.period=e),push:"",glossy:"","toggle-color":"primary",options:[{icon:"fas fa-sync",value:"today"},{label:l.$t("Day"),value:"-1 day"},{label:l.$t("Week"),value:"-1 week"},{label:l.$t("Month"),value:"-1 month"},{label:l.$t("Year"),value:"-1 year"}]},null,8,["modelValue","options"])),o(p,{flat:"",round:"",icon:"fas fa-question",class:"q-ma-xs"},{default:r(()=>[o(ee,{anchor:"top middle",self:"bottom middle",offset:[10,10],class:"text-h6"},{default:r(()=>[d(u(l.$t("Payment And Amount Are Expressed in Suguffi\xE8 Coin")),1)]),_:1})]),_:1}),o(te,{class:"q-ma-xs",clearable:"",borderless:"",dense:"",debounce:"300",modelValue:a.filter,"onUpdate:modelValue":n[3]||(n[3]=e=>a.filter=e),placeholder:l.$t("search")},{append:r(()=>[o(F,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),key:"0"}]),1032,["style","title","rows","columns","loading","filter","pagination"])])}var xe=ie(de,[["render",ce]]);export{xe as default};
