import{r as d,c as b,w as Y,o as W,u as H,af as p,ag as h,f as r,b8 as X,al as s,b9 as Z,F as C,ap as S,an as v,K as P,au as $,ah as x,Q as ee,am as z,aj as k,ai as V}from"./index.a0547624.js";import{Q as E}from"./QToggle.9c4a91bf.js";import{d as ae,e as le,Q as te}from"./export-file.878e87fb.js";import{Q as re}from"./QPopupProxy.e0979337.js";import{b as ne,d as O,c as oe}from"./QTable.1f996658.js";import{Q as ie,C as F}from"./ClosePopup.80a36c56.js";import{Q as M,a as B}from"./QTr.20580798.js";import{u as se}from"./use-quasar.ae366b6a.js";import{u as ue,t as de}from"./axios.f7466c17.js";import{a as ce}from"./Functions.1e50194a.js";import{_ as me}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as fe}from"./i18n.184d27f4.js";import"./QCheckbox.b19fbb11.js";import"./use-dark.8f226bc0.js";import"./QSeparator.bdc2a422.js";function K(a,n){let o=n!==void 0?n(a):a;return o=o==null?"":String(o),o=o.split('"').join('""'),`"${o}"`}const ge={setup(){const a=fe.global.t,n=se(),o=ue(),{crudAction:l,notifyAction:N}=o,A=Date.now(),t=ae.formatDate(A,"YYYY/MM/DD"),i=d(t),f=d("today"),w=d(!1),q=d(""),I=d(),Q=d([{name:"id",align:"center",label:"ID",field:"id",sortable:!0},{name:"ip",align:"center",label:"IP",field:"ip",sortable:!0},{name:"app",align:"center",label:a("app"),field:"app",sortable:!0},{name:"session",align:"center",label:a("session"),field:"session",sortable:!0},{name:"city",align:"center",label:a("city"),field:"city",sortable:!0},{name:"region",align:"center",label:a("region"),field:"region",sortable:!0},{name:"country",align:"center",label:a("country"),field:"country",sortable:!0},{name:"currency",align:"center",label:a("currency"),field:"currency",sortable:!0},{name:"currency_name",align:"center",label:a("currency_name"),field:"currency_name",sortable:!0},{name:"latitude",align:"center",label:a("latitude"),field:"latitude",sortable:!0},{name:"longitude",align:"center",label:a("longitude"),field:"longitude",sortable:!0},{name:"utc_offset",align:"center",label:a("utc_offset"),field:"utc_offset",sortable:!0},{name:"first_name",align:"center",label:a("first_name"),field:"first_name",sortable:!0},{name:"last_name",align:"center",label:a("last_name"),field:"last_name",sortable:!0},{name:"email",align:"center",label:a("email"),field:"email",sortable:!0},{name:"status",align:"center",label:a("status"),field:"status",sortable:!0},{name:"role",align:"center",label:a("role"),field:"role",sortable:!0},{name:"email_verified_at",align:"center",label:a("email_verified_at"),field:"email_verified_at",sortable:!0},{name:"updated_at",align:"center",label:a("updated_at"),field:"updated_at",sortable:!0},{name:"created_at",align:"center",label:a("created_at"),field:"created_at",sortable:!0}]),y=b(()=>"analyticsGetter"+f.value),G=b(()=>{var e;return(e=I.value)==null?void 0:e.to}),D=b(()=>{var e;return(e=o[y.value])==null?void 0:e.total}),R=b(()=>{var e;return(e=o.reloadGetter)==null?void 0:e.reload}),J=b(()=>{var e;return(e=o[y.value])==null?void 0:e.last_page}),T=b(()=>{var e;return((e=o[y.value])==null?void 0:e.data)||[]}),g=d({page:1,rowsPerPage:0,rowsNumber:D.value});function _(e){l({...e,url:"api/users/analytics",method:"get",period:f.value,page:g.value.page,perPage:g.value.rowsPerPage,mutate:y.value,timeout:1e3}).then(u=>I.value=u).catch(u=>N({error:"analyticsAction",e:u}))}Y([f,R],()=>_({}));const U=[];return Y(q,e=>{g.value.page=1,U.includes(e)||_({filterAnalytics:e,load:!0}),U.push(e)}),W(()=>_({})),{period:f,loading:w,timeago:de,total:D,filter:q,range:d(!1),expend:d(!1),proxyDate:i,height:d(screen.height/1.4),sessions(e){return e.filter(u=>u.user_id===e.user_id).sort((u,c)=>c.last_activity-u.last_activity)},save(){f.value="",_({expandingRow:!0,refresh:[y.value],from:i.value.from,to:i.value.to,proxyDate:i.value})},fNum(e){return isNaN(e)||e<9999?e:e<1e6?Math.round(e/1e3)+"K":e<1e7?(e/1e6).toFixed(2)+"M":e<1e9?Math.round(e/1e6)+"M":e<1e12?Math.round(e/1e9)+"B":"1T+"},exportTable(){const e=[Q.value.map(c=>K(c.label))].concat(T.value.map(c=>Q.value.map(m=>K(typeof m.field=="function"?m.field(c):c[m.field===void 0?m.name:m.field],m.format)).join(","))).join(`\r
`);le("table-export.csv",e,"text/csv")!==!0&&n.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},printEl:ce,onScroll({to:e,ref:u}){var j;const c=((j=T.value)==null?void 0:j.length)-1,m=J.value,L=g.value.page;w.value!==!0&&L<m&&e===c&&(w.value=!0,setTimeout(()=>{g.value.page++,_({load:!0}),H(()=>{u.refresh(),w.value=!1})},500),console.log("page",g.value.page,"<","lastPage",m,"to",e,"===",c,"lastIndex",">",0,"total",D.value,"TO",G.value))},pagination:g,columns:Q,rows:T}}},pe={class:"q-pa-md"},be={class:"row items-center justify-end q-gutter-sm"},ve={class:"text-h6"},ye=x("i",{class:"far fa-clock"},null,-1),_e=x("i",{class:"fab fa-chrome"},null,-1);function he(a,n,o,l,N,A){return p(),h("div",pe,[r(ne,{style:Z(`height: ${l.height}px`),class:"my-sticky-virtscroll-table",ref:"table",title:`${a.$t("Analytics")} ${l.total}`,rows:l.rows,columns:l.columns,"row-key":"name",loading:l.loading,filter:l.filter,"binary-state-sort":"","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:l.pagination,onVirtualScroll:l.onScroll},X({"top-right":s(()=>[r(v,{color:"primary","icon-right":"archive",label:a.$t("export_to_csv"),"no-caps":"",onClick:l.exportTable},null,8,["label","onClick"]),r(v,{color:"primary",class:"q-ma-xs",icon:"event",label:JSON.stringify(l.proxyDate)},{default:s(()=>[r(re,{"transition-show":"scale","transition-hide":"scale"},{default:s(()=>[r(te,{modelValue:l.proxyDate,"onUpdate:modelValue":n[1]||(n[1]=t=>l.proxyDate=t),range:l.range},{default:s(()=>[x("div",be,[P(r(v,{label:"Cancel",color:"primary",flat:""},null,512),[[F]]),r(E,{modelValue:l.range,"onUpdate:modelValue":n[0]||(n[0]=t=>l.range=t),label:"Range"},null,8,["modelValue"]),P(r(v,{label:"OK",color:"primary",flat:"",onClick:l.save},null,8,["onClick"]),[[F]])])]),_:1},8,["modelValue","range"])]),_:1})]),_:1},8,["label"]),r(oe,{modelValue:l.period,"onUpdate:modelValue":n[2]||(n[2]=t=>l.period=t),push:"",glossy:"","toggle-color":"primary",options:[{icon:"fas fa-sync",value:"today"},{label:a.$t("Day"),value:"-1 day"},{label:a.$t("Week"),value:"-1 week"},{label:a.$t("Month"),value:"-1 month"},{label:a.$t("Year"),value:"-1 year"}]},null,8,["modelValue","options"]),r(v,{icon:"fas fa-print",color:"primary",onClick:n[3]||(n[3]=t=>l.printEl("table"))}),r(E,{class:"q-ma-xs col-md-3",modelValue:l.expend,"onUpdate:modelValue":n[4]||(n[4]=t=>l.expend=t),"left-label":"",label:"Expend"},null,8,["modelValue"]),r(ie,{clearable:"",class:"q-ma-xs col-md-3",borderless:"",dense:"",debounce:"300",modelValue:l.filter,"onUpdate:modelValue":n[5]||(n[5]=t=>l.filter=t),placeholder:a.$t("search")},{append:s(()=>[r(ee,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),_:2},[l.expend?{name:"header",fn:s(t=>[r(M,{props:t},{default:s(()=>[r(O,{"auto-width":""}),(p(!0),h(C,null,S(t.cols,i=>(p(),z(O,{key:i.name,props:t},{default:s(()=>[k(V(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),key:"0"}:void 0,l.expend?{name:"body",fn:s(t=>[r(M,{props:t},{default:s(()=>[r(B,{"auto-width":""},{default:s(()=>[r(v,{size:"sm",color:"accent",round:"",dense:"",onClick:i=>t.expand=!t.expand,icon:t.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024),(p(!0),h(C,null,S(t.cols,i=>(p(),z(B,{key:i.name,props:t},{default:s(()=>[k(V(i.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"]),P(r(M,{props:t},{default:s(()=>[r(B,{colspan:"100%"},{default:s(()=>[(p(!0),h(C,null,S(l.sessions(t.row),(i,f)=>(p(),h("div",{key:f},[x("div",ve,[ye,k(" "+V(l.timeago(new Date(i.last_activity*1e3)))+" ",1),_e,k(" "+V(i.user_agent),1)])]))),128))]),_:2},1024)]),_:2},1032,["props"]),[[$,t.expand]])]),key:"1"}:void 0]),1032,["style","title","rows","columns","loading","filter","pagination","onVirtualScroll"])])}var Ie=me(ge,[["render",he]]);export{Ie as default};
