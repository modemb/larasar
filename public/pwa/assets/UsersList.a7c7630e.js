import{Q as L}from"./QCard.3c4c419d.js";import{k as M}from"./QCheckbox.9bc58682.js";import{Q as H,a as i}from"./QTr.09fa586b.js";import{r as c,c as f,w as Y,o as J,u as K,ae as S,af as p,ag as P,f as t,al as r,ah as O,b9 as X,F as T,aj as y,ai as w,an as g,ao as D,am as V,ak as q,Q as Z}from"./index.13c3f144.js";import{b as $,c as ee}from"./QTable.067c00e4.js";import{Q as ae}from"./ClosePopup.1bf598b3.js";import{u as le}from"./use-quasar.46364531.js";import{u as te,q as re,a as j}from"./axios.3783d787.js";import oe from"./Profile.a317e596.js";import{S as ne}from"./UserShare.b1887a22.js";import se from"./Auth.849ed115.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import{i18n as de}from"./i18n.a7c38d7c.js";import"./use-dark.eef62c6b.js";import"./QSeparator.fa2931ea.js";import"./QBar.bf662a71.js";import"./QLayout.b1ae1389.js";import"./QCardSection.e3d75130.js";import"./QTooltip.d9557058.js";import"./QForm.7c05eede.js";import"./QPage.c4ac390d.js";import"./QPageContainer.79c4020e.js";import"./Functions.1e50194a.js";import"./UserReports.e276e430.js";import"./QToggle.3517a43d.js";import"./export-file.2729cbf1.js";import"./QPopupProxy.8891f933.js";import"./UserFiles.38746bd3.js";import"./QImg.e4a17f66.js";const ue={components:{Profile:oe,AddUser:se,Share:ne},setup(){var I,N;const n=(N=(I=de)==null?void 0:I.global)==null?void 0:N.t,s=le(),d=te(),{crudAction:l,notifyAction:U}=d,A=c(!1),C=c(null),u=c("users"),k=c(!1),a=c(""),v=f(()=>{var e;return(e=d[u.value])==null?void 0:e.last_page}),o=f(()=>{var e;return(e=d[u.value])==null?void 0:e.total}),R=f(()=>{var e;return(e=d.configGetter)==null?void 0:e.ipDebug}),W=f(()=>{var e;return(e=d.reloadGetter)==null?void 0:e.reload}),x=f(()=>{var e;return((e=d[u.value])==null?void 0:e.data)||[]}),b=f(()=>d.authGetter),m=c({sortBy:"desc",descending:!1,page:1,rowsPerPage:0,rowsNumber:o.value}),B=[];Y(a,e=>{m.value.page=1,B.includes(e)||h({filterUsers:e,load:!0}),B.push(e)}),Y([u,W],()=>{m.value.page=1,h({})}),J(()=>{var e;return h({usersData:u.value=((e=b.value)==null?void 0:e.role)==="Admin"?"users":"my_users"})});function h(e){l({...e,url:`api/users/${b.value.id}`,method:"get",timeout:1e3,page:m.value.page,perPage:m.value.rowsPerPage,mutate:u.value}).catch(_=>U({error:"usersAction",e:_}))}function Q(e){b.value&&confirm("Are You Sure You Want To "+(e.forever?"Delete Forever":e.remove?"Remove":"Delete")+" User "+e.first_name)&&j({url:`/api/users/${e.id}`,data:{authID:b.value.id,remove:e.remove},method:"delete"}).then(()=>h({refresh:["reloadApp"]})).catch(_=>U({error:"deleteAction",e:_}))}return{ipDebug:R,total:o,desktop:s.platform.is.desktop,height:screen.height/1.4,price:"0.00",shareLink:c(!1),addUser:c(!1),editUser:A,shareData:f(()=>{var e;return(e=d.shareDataGetter)==null?void 0:e.shareData}),usersData:u,loading:k,auth:b,user:C,onScroll({to:e,ref:_}){var F;const G=((F=x.value)==null?void 0:F.length)-1,z=m.value.page,E=v.value;k.value!==!0&&z<E&&e===G&&(k.value=!0,setTimeout(()=>{m.value.page++,h({load:!0}),K(()=>{_.refresh(),k.value=!1})},500)),console.log("page",z,"<","lastPage",E,"to",e,"===",G,"lastIndex",">",0,"total",o.value)},usersAction:h,logUserAction:re,Edit(e){m.value.page=1,A.value=!0,C.value=e},Delete:Q,delete_forever(e){Q({...e,forever:!0})},remove(e){Q({...e,remove:!0})},restore(e){j.post("api/users",e).then(()=>h({refresh:["reloadApp"]})).catch(_=>U({error:"restoreUser",e:_}))},columns:f(()=>{var e;return[{name:"id",align:"center",label:"ID",field:"id",sortable:!0},{name:"name",align:"center",label:n("user_name"),field:"name",sortable:!0},{name:"first_name",align:"center",label:n("first_name"),field:"first_name",sortable:!0},{name:"last_name",align:"center",label:n("last_name"),field:"last_name",sortable:!0},{name:"email",align:"center",label:n("email"),field:"email",sortable:!0},{name:"status",align:"center",label:n("status"),field:"status",sortable:!0},{name:"role",align:"center",label:n("role"),field:"role",sortable:!0}].concat(((e=b.value)==null?void 0:e.role)==="Admin"?[{name:"login",align:"center",label:n("login"),field:"login",sortable:!1},{name:"edit",align:"center",label:n("edit/restore"),field:"edit",sortable:!1},{name:"delete",align:"center",label:n("delete/forever"),field:"delete",sortable:!1}]:[])}),rows:x,pagination:m,filter:a}}},me={class:"q-pa-md"};function ce(n,s,d,l,U,A){const C=S("addUser"),u=S("Profile"),k=S("Share");return p(),P(T,null,[t(M,{modelValue:l.addUser,"onUpdate:modelValue":s[0]||(s[0]=a=>l.addUser=a)},{default:r(()=>[t(L,{class:"my-card text-white",style:{width:"100%"}},{default:r(()=>[t(C,{auth:l.auth},null,8,["auth"])]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:l.editUser,"onUpdate:modelValue":s[1]||(s[1]=a=>l.editUser=a)},{default:r(()=>[t(L,{class:"my-card text-black col-1",style:{width:"1000px"}},{default:r(()=>[t(u,{user:l.user,onUpdate:l.usersAction},null,8,["user","onUpdate"])]),_:1})]),_:1},8,["modelValue"]),O("div",me,[t($,{style:X(`height: ${l.height}px`),class:"my-sticky-virtscroll-table",ref:"table",title:`${n.$t("users_list")} ${l.total}`,rows:l.rows,columns:l.columns,"row-key":"name",filter:l.filter,loading:l.loading,"binary-state-sort":"","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:l.pagination,"onUpdate:pagination":s[5]||(s[5]=a=>l.pagination=a),onVirtualScroll:l.onScroll},{body:r(a=>[t(H,{props:a},{default:r(()=>{var v;return[t(i,{key:"id",props:a},{default:r(()=>[y(w(a.row.id),1)]),_:2},1032,["props"]),t(i,{key:"name",props:a},{default:r(()=>{var o;return[y(w((o=a.row)==null?void 0:o.name),1)]}),_:2},1032,["props"]),t(i,{key:"first_name",props:a},{default:r(()=>[y(w(a.row.first_name),1)]),_:2},1032,["props"]),t(i,{key:"last_name",props:a},{default:r(()=>[y(w(a.row.last_name),1)]),_:2},1032,["props"]),t(i,{key:"email",props:a},{default:r(()=>{var o;return[t(g,{flat:"","icon-right":(o=a.row)!=null&&o.email_verified_at?"check":"",label:a.row.email},null,8,["icon-right","label"])]}),_:2},1032,["props"]),t(i,{key:"status",props:a},{default:r(()=>[y(w(a.row.status),1)]),_:2},1032,["props"]),t(i,{key:"role",props:a},{default:r(()=>[y(w(a.row.role),1)]),_:2},1032,["props"]),((v=l.auth)==null?void 0:v.role)==="Admin"?(p(),P(T,{key:0},[t(i,{key:"login",props:a},{default:r(()=>[t(g,{icon:"fas fa-sign-in-alt",rounded:"",onClick:D(o=>l.logUserAction(a.row.id),["prevent"])},null,8,["onClick"])]),_:2},1032,["props"]),t(i,{key:"edit",props:a},{default:r(()=>[t(g,{icon:"edit",rounded:"",class:"q-ma-md",onClick:D(o=>l.Edit(a.row),["prevent"])},null,8,["onClick"])]),_:2},1032,["props"]),l.usersData=="users"?(p(),V(i,{key:"delete",props:a},{default:r(()=>[t(g,{icon:"delete",rounded:"",onClick:D(o=>l.Delete(a.row),["prevent"])},null,8,["onClick"])]),_:2},1032,["props"])):l.usersData=="my_users"?(p(),V(i,{key:"edit",props:a},{default:r(()=>[t(g,{icon:"remove",rounded:"",onClick:D(o=>l.remove(a.row),["prevent"])},null,8,["onClick"])]),_:2},1032,["props"])):(p(),P(T,{key:2},[t(i,{key:"delete",props:a},{default:r(()=>[t(g,{icon:"restore",rounded:"",class:"q-ma-md",onClick:o=>l.restore(a.row)},null,8,["onClick"])]),_:2},1032,["props"]),t(i,{key:"delete",props:a},{default:r(()=>[t(g,{icon:"delete_forever",rounded:"",onClick:D(o=>l.delete_forever(a.row),["prevent"])},null,8,["onClick"])]),_:2},1032,["props"])],64))],64)):q("",!0)]}),_:2},1032,["props"])]),"top-right":r(()=>{var a,v;return[((a=l.auth)==null?void 0:a.role)==="Admin"?(p(),V(ee,{key:0,modelValue:l.usersData,"onUpdate:modelValue":s[2]||(s[2]=o=>l.usersData=o),push:"",glossy:"",class:"q-ma-xs col-md-3","toggle-color":"primary",options:[{label:n.$t("users"),value:"users"},{label:n.$t("Trash"),value:"userTrashed"},{label:n.$t("Deleted"),value:"userDeleted"},{label:n.$t("my_users"),value:"my_users"}]},null,8,["modelValue","options"])):q("",!0),((v=l.auth)==null?void 0:v.role)==="Admin"?(p(),V(g,{key:1,icon:"add_circle_outline",rounded:"",class:"q-ma-xs col-md-3",label:n.$t("add_user"),onClick:s[3]||(s[3]=o=>l.addUser=!0)},null,8,["label"])):q("",!0),t(k,{shareData:l.shareData},null,8,["shareData"]),t(ae,{clearable:"",class:"q-ma-xs col-md-3",borderless:"",dense:"",debounce:"300",modelValue:l.filter,"onUpdate:modelValue":s[4]||(s[4]=o=>l.filter=o),placeholder:n.$t("search")},{append:r(()=>[t(Z,{name:"search"})]),_:1},8,["modelValue","placeholder"])]}),_:1},8,["style","title","rows","columns","filter","loading","pagination","onVirtualScroll"])])],64)}var Me=ie(ue,[["render",ce]]);export{Me as default};
